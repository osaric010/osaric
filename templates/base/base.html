{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <link rel="apple-touch-icon" href="{% static 'images/icon-192x192.png' %}">
    <title>{% block title %}حسابات أوساريك{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}"
    
    <!-- Bootstrap 5 RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts - Arabic -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Custom DateTime CSS -->
    <link href="{% static 'css/datetime.css' %}" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            z-index: 1000;
            overflow-y: scroll !important;
            overflow-x: hidden;
            scroll-behavior: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
            height: 100vh;
        }

        /* تحسين شريط التمرير للمتصفحات المبنية على Webkit */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        /* ضمان إمكانية التمرير */
        .sidebar {
            overscroll-behavior: contain;
            touch-action: pan-y;
            pointer-events: auto;
            user-select: none;
        }

        /* تحسين التمرير للقوائم المنسدلة */
        .sidebar .dropdown-menu {
            max-height: 300px;
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        /* مؤشر التمرير النشط */
        .sidebar.scrolling::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.6);
            box-shadow: 0 0 5px rgba(255,255,255,0.3);
        }

        .sidebar.scrolling {
            scrollbar-color: rgba(255,255,255,0.6) transparent;
        }

        /* تنسيق الساعة والتاريخ */
        .datetime-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .datetime-display:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .datetime-display .fw-bold {
            font-size: 1rem;
            color: #2c3e50;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .datetime-display small {
            font-size: 0.75rem;
            color: #6c757d;
        }

        .datetime-display i {
            opacity: 0.8;
        }
        
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255,255,255,0.1);
            transform: translateX(-5px);
        }
        
        .sidebar .nav-link i {
            margin-left: 0.5rem;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            padding: 0;
            margin-top: 0;
            margin-right: 280px;
            min-height: 100vh;
        }

        .content-wrapper {
            padding: 15px 20px 25px 20px;
            background: transparent;
        }

        /* تحسين المسافات للبطاقات */
        .content-wrapper .card {
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-radius: 12px;
        }

        /* تحسين المسافات للعناوين */
        .content-wrapper h1,
        .content-wrapper h2,
        .content-wrapper h3 {
            margin-bottom: 20px;
            margin-top: 0;
        }

        /* إزالة أي مسافات علوية غير مرغوب فيها */
        .content-wrapper > *:first-child {
            margin-top: 0 !important;
        }

        /* التأكد من عدم وجود مسافات في الحاوي الرئيسي */
        .container-fluid {
            padding-top: 0;
        }

        .row {
            margin-top: 0;
        }

        .row:first-child {
            margin-top: 0 !important;
        }

        /* تحسين المسافات للصفوف */
        .content-wrapper .row {
            margin-bottom: 15px;
        }

        .content-wrapper .row:last-child {
            margin-bottom: 0;
        }
        
        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 1rem 1rem 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(102, 126, 234, 0.4);
        }
        
        .stats-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 1rem 2rem rgba(0,0,0,0.1);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            color: #6c757d;
            font-weight: 500;
        }
        
        .top-navbar {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 0.75rem 0;
            margin-bottom: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #e9ecef;
        }
        
        .datetime-display {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .datetime-display .fw-bold {
            font-size: 1.1em;
            margin-bottom: 2px;
        }

        .datetime-display small {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .datetime-display i {
            margin-left: 4px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Company Logo in Header */
        .company-logo-header {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-logo {
            height: 45px;
            width: auto;
            max-width: 120px;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .header-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-color: var(--primary-color);
        }

        .company-logo-header:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        /* Global Search Styles */
        .global-search-container {
            min-width: 300px;
            max-width: 400px;
        }

        .global-search-input {
            border-radius: 25px 0 0 25px;
            border: 2px solid #e9ecef;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .global-search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .global-search-container .btn {
            border-radius: 0 25px 25px 0;
            border: 2px solid #e9ecef;
            border-left: none;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }

        .global-search-container .btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .search-shortcut-hint {
            top: -25px;
            right: 0;
            font-size: 0.75rem;
            opacity: 0.7;
            pointer-events: none;
        }

        .global-search-results {
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            z-index: 1050;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 5px;
        }

        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            transition: background-color 0.2s ease;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .search-result-item:hover {
            background-color: #f8f9fa;
            color: inherit;
            text-decoration: none;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.25rem;
        }

        .search-result-description {
            font-size: 0.875rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        .search-result-type {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
            font-weight: 500;
        }

        .search-result-type.type-item {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .search-result-type.type-person {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }

        .search-result-type.type-invoice {
            background-color: #e8f5e8;
            color: #388e3c;
        }

        .search-result-type.type-warehouse {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .search-result-type.type-bank {
            background-color: #e1f5fe;
            color: #0277bd;
        }

        .search-result-type.type-treasury {
            background-color: #fce4ec;
            color: #c2185b;
        }

        .search-result-type.type-section {
            background-color: #f3e5f5;
            color: #7b1fa2;
            font-weight: 600;
        }

        .search-result-type.type-document {
            background-color: #fff8e1;
            color: #f57f17;
        }

        .search-result-type.type-inventory {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .search-result-icon {
            width: 20px;
            text-align: center;
            margin-left: 0.5rem;
        }

        .search-section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            font-weight: 600;
            font-size: 0.875rem;
            margin: 0;
            border-bottom: 1px solid #e9ecef;
        }

        .search-quick-actions {
            padding: 0.75rem 1rem;
            background-color: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .search-quick-action {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem 0.25rem 0 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            font-size: 0.75rem;
            color: #495057;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .search-quick-action:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-color: #667eea;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .global-search-container {
                min-width: 250px;
                max-width: 300px;
            }
        }

        @media (max-width: 992px) {
            .global-search-container {
                min-width: 200px;
                max-width: 250px;
            }
        }

        @media (max-width: 768px) {
            .global-search-container {
                display: none;
            }
        }

        /* Mobile Search Styles */
        .mobile-search-container {
            position: relative;
        }

        .mobile-search-container .form-control {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 20px 0 0 20px;
        }

        .mobile-search-container .form-control::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .mobile-search-container .form-control:focus {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(255,255,255,0.25);
        }

        .mobile-search-container .btn {
            border-radius: 0 20px 20px 0;
            border: 1px solid rgba(255,255,255,0.3);
            border-left: none;
        }

        .mobile-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 5px;
        }

        .mobile-search-results .search-result-item {
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .mobile-search-results .search-result-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .mobile-search-results .search-result-title {
            color: white;
        }

        .mobile-search-results .search-result-description {
            color: rgba(255,255,255,0.7);
        }

        .mobile-search-results .search-section-header {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            /* Improve touch targets */
            .btn {
                min-height: 44px;
                padding: 0.75rem 1rem;
            }

            .form-control {
                min-height: 44px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Sidebar improvements */
            .sidebar {
                width: 280px !important;
            }

            .sidebar .nav-link {
                padding: 1rem;
                font-size: 1rem;
            }

            /* Main content adjustments */
            .main-content {
                padding: 1rem;
            }

            /* Table responsiveness */
            .table-responsive {
                font-size: 0.875rem;
            }

            /* Card improvements */
            .card {
                margin-bottom: 1rem;
            }

            /* Header adjustments */
            .header {
                padding: 0.5rem 1rem;
            }

            /* Dropdown improvements */
            .dropdown-menu {
                font-size: 0.9rem;
            }

            /* Form improvements */
            .form-label {
                font-weight: 600;
                margin-bottom: 0.5rem;
            }

            /* Button groups */
            .btn-group .btn {
                padding: 0.5rem 0.75rem;
            }
        }

        /* Extra small devices */
        @media (max-width: 576px) {
            .container-fluid {
                padding: 0.5rem;
            }

            .card-body {
                padding: 1rem;
            }

            .btn-sm {
                padding: 0.375rem 0.5rem;
                font-size: 0.8rem;
            }

            /* Hide less important columns in tables */
            .table .d-none-xs {
                display: none !important;
            }

            /* Stack form elements */
            .row > .col-md-6,
            .row > .col-lg-6 {
                margin-bottom: 1rem;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover {
                transform: none;
            }

            .card:hover {
                transform: none;
                box-shadow: none;
            }

            /* Larger touch targets */
            .nav-link {
                padding: 1rem !important;
            }

            .dropdown-item {
                padding: 0.75rem 1rem;
            }
        }

        /* Landscape orientation on mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .sidebar {
                width: 250px !important;
            }

            .main-content {
                padding: 0.5rem;
            }
        }

        .header-logo-placeholder {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-color), #4a90e2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .header-logo-placeholder:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-color: rgba(255,255,255,0.3);
        }

        /* Logo animation on page load */
        @keyframes logoFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .company-logo-header {
            animation: logoFadeIn 0.6s ease-out;
        }

        /* Responsive logo */
        @media (max-width: 1200px) {
            .company-logo-header {
                display: none !important;
            }

            .ms-auto {
                margin-right: 0 !important;
            }
        }

        @media (min-width: 1400px) {
            .header-logo {
                height: 50px;
                max-width: 140px;
            }

            .header-logo-placeholder {
                width: 50px;
                height: 50px;
                font-size: 1.7rem;
            }

            .company-logo-header {
                right: 30px;
            }
        }

        /* تأكد من عدم تداخل الشعار مع العناصر الأخرى */
        .navbar .container-fluid {
            position: relative;
        }

        .navbar .ms-auto {
            transition: margin-right 0.3s ease;
        }
        
        /* Dropdown Menu Styles */
        .sidebar .dropdown-menu {
            background: rgba(255,255,255,0.95);
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            margin-top: 0.5rem;
            padding: 0.5rem 0;
        }

        .sidebar .dropdown-item {
            color: #495057;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .sidebar .dropdown-item:hover {
            background-color: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: translateX(-3px);
        }

        .sidebar .dropdown-item i {
            width: 20px;
            text-align: center;
        }

        .sidebar .dropdown-divider {
            margin: 0.5rem 0;
            border-color: rgba(0,0,0,0.1);
        }

        .text-purple {
            color: #6f42c1 !important;
        }

        /* تحسين مظهر قائمة شؤون العاملين */
        #hrDropdown + .dropdown-menu {
            width: 320px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .dropdown-header {
            color: var(--bs-info);
            font-weight: bold;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
            background-color: rgba(13, 202, 240, 0.1);
            border-radius: 0.25rem;
        }

        /* Easy-to-Use Dropdown Menu Styles */
        .easy-dropdown {
            position: relative;
        }

        .easy-dropdown .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            max-height: 80vh;
            margin: 0;
            padding: 1rem;
            border: 2px solid #e3f2fd;
            border-radius: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            backdrop-filter: blur(10px);
            animation: easyDropdownSlide 0.3s ease;
            z-index: 1060;
            overflow-y: auto;
        }

        @keyframes easyDropdownSlide {
            from {
                opacity: 0;
                transform: translateY(-15px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .easy-dropdown-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 0.75rem;
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
        }

        .easy-dropdown-section:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .easy-dropdown-section:last-child {
            margin-bottom: 0;
        }

        .easy-dropdown-header {
            color: #2c3e50;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            align-items: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .easy-dropdown-header i {
            margin-left: 0.5rem;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .easy-dropdown-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            color: #495057;
            text-decoration: none;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            border-right: 3px solid transparent;
            font-size: 0.95rem;
            position: relative;
            background: transparent;
        }

        .easy-dropdown-item:hover {
            color: #ffffff;
            text-decoration: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-right-color: #667eea;
            transform: translateX(-3px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .easy-dropdown-item i {
            width: 24px;
            text-align: center;
            margin-left: 0.75rem;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .easy-dropdown-item:hover i {
            transform: scale(1.1);
        }

        .easy-dropdown-item .item-text {
            flex: 1;
            font-weight: 500;
        }

        .easy-dropdown-item .item-badge {
            background: #e9ecef;
            color: #6c757d;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            margin-right: 0.5rem;
            transition: all 0.2s ease;
        }

        .easy-dropdown-item:hover .item-badge {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Color themes for different sections */
        .easy-dropdown-section.theme-success .easy-dropdown-header {
            color: #28a745;
            border-bottom-color: #28a745;
        }

        .easy-dropdown-section.theme-success .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .easy-dropdown-section.theme-primary .easy-dropdown-header {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .easy-dropdown-section.theme-primary .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .easy-dropdown-section.theme-info .easy-dropdown-header {
            color: #17a2b8;
            border-bottom-color: #17a2b8;
        }

        .easy-dropdown-section.theme-info .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
        }

        .easy-dropdown-section.theme-warning .easy-dropdown-header {
            color: #fd7e14;
            border-bottom-color: #fd7e14;
        }

        .easy-dropdown-section.theme-warning .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #fd7e14 0%, #ffc107 100%);
            box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
        }

        .easy-dropdown-section.theme-danger .easy-dropdown-header {
            color: #dc3545;
            border-bottom-color: #dc3545;
        }

        .easy-dropdown-section.theme-danger .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .easy-dropdown-section.theme-secondary .easy-dropdown-header {
            color: #6c757d;
            border-bottom-color: #6c757d;
        }

        .easy-dropdown-section.theme-secondary .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .easy-dropdown-section.theme-dark .easy-dropdown-header {
            color: #343a40;
            border-bottom-color: #343a40;
        }

        .easy-dropdown-section.theme-dark .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #343a40 0%, #212529 100%);
            box-shadow: 0 4px 12px rgba(52, 58, 64, 0.3);
        }

        .easy-dropdown-section.theme-purple .easy-dropdown-header {
            color: #6f42c1;
            border-bottom-color: #6f42c1;
        }

        .easy-dropdown-section.theme-purple .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #6f42c1 0%, #6610f2 100%);
            box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3);
        }

        .easy-dropdown-section.theme-secondary .easy-dropdown-header {
            color: #6c757d;
            border-bottom-color: #6c757d;
        }

        .easy-dropdown-section.theme-secondary .easy-dropdown-item:hover {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        /* Taskbar Settings Styles */
        .taskbar-none {
            display: none !important;
        }

        .taskbar-auto_hide {
            transition: opacity 0.3s ease;
        }

        .taskbar-auto_hide:not(:hover) {
            opacity: 0.3;
        }

        .taskbar-vertical {
            writing-mode: vertical-lr;
            text-orientation: mixed;
            width: 80px !important;
            height: 100vh !important;
            position: fixed !important;
            left: 0 !important;
            top: 0 !important;
            z-index: 1050;
        }

        .taskbar-vertical .navbar-nav {
            flex-direction: column !important;
            height: 100%;
        }

        .taskbar-vertical .nav-link {
            writing-mode: horizontal-tb;
            text-align: center;
            padding: 15px 5px !important;
        }

        .taskbar-horizontal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1050;
        }

        /* Taskbar Themes */
        .taskbar-theme-dark {
            background: linear-gradient(135deg, #343a40 0%, #212529 100%) !important;
        }

        .taskbar-theme-light {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
            color: #212529 !important;
        }

        .taskbar-theme-light .nav-link {
            color: #212529 !important;
        }

        .taskbar-theme-blue {
            background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%) !important;
        }

        /* Taskbar Sizes */
        .taskbar-size-small {
            font-size: 0.8rem;
        }

        .taskbar-size-small .nav-link {
            padding: 8px 12px !important;
        }

        .taskbar-size-medium {
            font-size: 1rem;
        }

        .taskbar-size-large {
            font-size: 1.2rem;
        }

        .taskbar-size-large .nav-link {
            padding: 15px 20px !important;
        }

        /* Hide icons or text based on settings */
        .taskbar-hide-icons .nav-link i {
            display: none !important;
        }

        .taskbar-hide-text .nav-link .item-text {
            display: none !important;
        }

        /* License status in navbar */
        .license-status {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: 10px;
        }

        .license-expired {
            background-color: #dc3545;
            color: white;
            animation: pulse 2s infinite;
        }

        .license-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .license-active {
            background-color: #198754;
            color: white;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Quick access button */
        .quick-access-btn {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1070;
            animation: pulse-glow 3s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 4px 30px rgba(102, 126, 234, 0.7);
            }
        }

        .quick-access-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(102, 126, 234, 0.6);
            animation: none;
        }

        .quick-access-btn:active {
            transform: scale(0.95);
        }

        .quick-access-btn:active {
            transform: scale(0.95);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .easy-dropdown .dropdown-menu {
                width: 95vw;
                right: 2.5vw;
                padding: 0.75rem;
                border-radius: 0.75rem;
                max-height: 85vh;
            }

            .easy-dropdown-section {
                padding: 0.75rem;
                margin-bottom: 1rem;
            }

            .easy-dropdown-item {
                padding: 0.6rem 0.75rem;
                font-size: 0.9rem;
            }

            .easy-dropdown-header {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .quick-access-btn {
                bottom: 1rem;
                left: 1rem;
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .easy-dropdown .dropdown-menu {
                width: 98vw;
                right: 1vw;
                padding: 0.5rem;
                max-height: 90vh;
            }

            .easy-dropdown-section {
                padding: 0.5rem;
                margin-bottom: 0.75rem;
            }

            .easy-dropdown-item {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
        }

        /* Custom scrollbar for easy dropdown */
        .easy-dropdown .dropdown-menu::-webkit-scrollbar {
            width: 6px;
        }

        .easy-dropdown .dropdown-menu::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 3px;
        }

        .easy-dropdown .dropdown-menu::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
        }

        .easy-dropdown .dropdown-menu::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        /* Loading animation */
        .dropdown-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .dropdown-spinner {
            width: 2rem;
            height: 2rem;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Dropdown menu max height and scroll */
        .dropdown-menu {
            max-height: 500px;
            overflow-y: auto;
        }

        /* تحسين مظهر قائمة التقارير */
        #reportsDropdown + .dropdown-menu {
            width: 350px;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* تحسين مظهر قائمة الفروع */
        #branchesDropdown + .dropdown-menu {
            width: 380px;
            max-height: 75vh;
            overflow-y: auto;
        }

        /* تحسين عرض النوافذ المنبثقة للفروع */
        .dropdown-submenu .dropdown-menu {
            z-index: 1060;
        }

        /* تحسين مظهر عناصر النقدية والبنوك */
        .dropdown-item[href*="cash-received"] i,
        .dropdown-item[href*="cash-sent"] i {
            color: #28a745 !important;
        }

        .dropdown-item[href*="bank-deposits"] i,
        .dropdown-item[href*="bank-withdrawals"] i {
            color: #007bff !important;
        }

        /* تأثيرات hover محسنة */
        .dropdown-submenu .dropdown-toggle:hover i {
            transform: scale(1.1);
            transition: transform 0.3s ease;
        }

        /* تحسين مظهر الأيقونات في النوافذ المنبثقة */
        .dropdown-submenu .dropdown-menu .dropdown-item i {
            width: 20px;
            text-align: center;
            margin-left: 8px;
            transition: all 0.3s ease;
        }

        .dropdown-submenu .dropdown-menu .dropdown-item:hover i {
            transform: scale(1.1) translateX(-2px);
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                right: -280px;
                width: 280px;
                height: 100vh;
                z-index: 1000;
                transition: right 0.3s ease;
            }

            .sidebar.show {
                right: 0;
            }

            .main-content {
                margin-right: 0;
                padding: 0;
                margin-top: 0;
            }

            .content-wrapper {
                padding: 10px 10px 15px 10px;
            }

            .top-navbar {
                padding: 0.5rem 0;
            }

            .datetime-display {
                padding: 4px 8px;
                font-size: 0.85rem;
            }

            .datetime-display .fw-bold {
                font-size: 0.9rem;
            }

            .datetime-display small {
                font-size: 0.7rem;
            }

            /* تحسين النوافذ المنبثقة على الشاشات الصغيرة */
            .dropdown-submenu .dropdown-menu {
                position: static !important;
                width: 100% !important;
                margin: 0.5rem 0 !important;
                border-radius: 0.5rem !important;
                box-shadow: inset 0 0 10px rgba(0,0,0,0.1) !important;
                background: rgba(102, 126, 234, 0.05) !important;
            }

            .dropdown-submenu .dropdown-toggle::after {
                transform: rotate(0deg) !important;
                content: "▼" !important;
            }

            .dropdown-submenu .dropdown-menu .dropdown-item {
                padding: 0.5rem 1.5rem !important;
                font-size: 0.85rem !important;
            }
        }

        /* تحسينات إضافية للنوافذ المنبثقة */
        .dropdown-submenu .dropdown-menu .dropdown-item {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* تأثير النقر على النوافذ المنبثقة */
        .dropdown-submenu .dropdown-toggle:active {
            transform: scale(0.98);
            transition: transform 0.1s ease;
        }

        /* مؤشر بصري للنوافذ المنبثقة النشطة */
        .dropdown-submenu.active .dropdown-toggle {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            color: #667eea;
            border-left: 3px solid #667eea;
        }

        /* تحسين مظهر النص في النوافذ المنبثقة */
        .dropdown-submenu .dropdown-toggle {
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .dropdown-submenu .dropdown-menu .dropdown-item {
            font-size: 0.85rem;
            line-height: 1.4;
        }

        /* إضافة ظلال للنوافذ المنبثقة */
        .dropdown-submenu .dropdown-menu {
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        /* تحسين الألوان للنوافذ المنبثقة المختلفة */
        .dropdown-submenu:nth-child(1) .dropdown-toggle {
            border-left: 3px solid #28a745;
        }

        .dropdown-submenu:nth-child(2) .dropdown-toggle {
            border-left: 3px solid #007bff;
        }

        .dropdown-submenu:nth-child(3) .dropdown-toggle {
            border-left: 3px solid #17a2b8;
        }

        /* تأثير التمرير السلس */
        .dropdown-submenu .dropdown-menu {
            scroll-behavior: smooth;
        }

        /* تحسين مظهر شريط التمرير */
        .dropdown-submenu .dropdown-menu::-webkit-scrollbar {
            width: 4px;
        }

        .dropdown-submenu .dropdown-menu::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
        }

        .dropdown-submenu .dropdown-menu::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 2px;
        }

        .dropdown-submenu .dropdown-menu::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.8);
        }

        /* دعم النوافذ المنبثقة متعددة المستويات */
        .dropdown-submenu .dropdown-submenu {
            position: relative;
        }

        .dropdown-submenu .dropdown-submenu .dropdown-menu {
            top: 0;
            left: 100%;
            margin-top: -1px;
            border-radius: 0 8px 8px 8px;
            min-width: 250px;
            background: rgba(255,255,255,0.98);
            border: 1px solid rgba(0,0,0,0.15);
            box-shadow: 0 0.75rem 1.5rem rgba(0,0,0,0.25);
            backdrop-filter: blur(15px);
            z-index: 1070;
        }

        .dropdown-submenu .dropdown-submenu:hover .dropdown-menu {
            display: block;
        }

        .dropdown-submenu .dropdown-submenu .dropdown-toggle::after {
            content: "◀";
            transform: none;
            position: absolute;
            right: 8px;
            top: 50%;
            margin-top: -8px;
            color: #667eea;
            font-size: 0.8rem;
        }

        .dropdown-submenu .dropdown-submenu .dropdown-toggle {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border-radius: 0.25rem;
            font-weight: 500;
            position: relative;
            padding-right: 2rem;
        }

        .dropdown-submenu .dropdown-submenu .dropdown-toggle:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            color: #667eea;
        }

        /* RTL support for nested submenus */
        [dir="rtl"] .dropdown-submenu .dropdown-submenu .dropdown-menu {
            left: auto;
            right: 100%;
            border-radius: 8px 0 8px 8px;
        }

        [dir="rtl"] .dropdown-submenu .dropdown-submenu .dropdown-toggle::after {
            content: "▶";
            right: auto;
            left: 8px;
        }

        /* تحسين مظهر العناصر في النوافذ الفرعية */
        .dropdown-submenu .dropdown-submenu .dropdown-menu .dropdown-item {
            padding: 0.6rem 1rem;
            font-size: 0.8rem;
            border-left: 2px solid transparent;
            margin: 0.05rem 0.3rem;
        }

        .dropdown-submenu .dropdown-submenu .dropdown-menu .dropdown-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
            border-left-color: #667eea;
            transform: translateX(-3px);
            color: #667eea;
        }

        /* ألوان مميزة للنوافذ الفرعية */
        .dropdown-submenu .dropdown-submenu:nth-child(odd) .dropdown-toggle {
            border-left: 2px solid #28a745;
        }

        .dropdown-submenu .dropdown-submenu:nth-child(even) .dropdown-toggle {
            border-left: 2px solid #007bff;
        }

        /* تأثيرات خاصة للنوافذ الفرعية */
        .dropdown-submenu .dropdown-submenu .dropdown-menu {
            animation: slideInNested 0.4s ease;
        }

        @keyframes slideInNested {
            from {
                opacity: 0;
                transform: translateX(-15px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }
    </style>

    <!-- Dynamic UI Settings CSS -->
    <style>
        :root {
            /* Colors */
            --primary-color: {{ ui_settings.ui_primary_color|default:"#0d6efd" }};
            --secondary-color: {{ ui_settings.ui_secondary_color|default:"#6c757d" }};
            --success-color: {{ ui_settings.ui_success_color|default:"#198754" }};
            --danger-color: {{ ui_settings.ui_danger_color|default:"#dc3545" }};
            --warning-color: {{ ui_settings.ui_warning_color|default:"#ffc107" }};
            --info-color: {{ ui_settings.ui_info_color|default:"#0dcaf0" }};

            /* Typography */
            --font-family: {{ ui_settings.ui_font_family|default:"Cairo, sans-serif" }};
            --font-size: {{ ui_settings.ui_font_size|default:"14" }}px;

            /* Layout */
            --border-radius: {{ ui_settings.ui_border_radius|default:"8" }}px;
            --sidebar-width: {{ ui_settings.ui_sidebar_width|default:"280" }}px;
            --header-height: {{ ui_settings.ui_header_height|default:"60" }}px;

            /* Company Info */
            --company-name: "{{ system_settings.company_name|default:"شركة أوساريك للحسابات" }}";
            --company-phone: "{{ system_settings.company_phone|default:"+966501234567" }}";
            --company-email: "{{ system_settings.company_email|default:"info@osaric.com" }}";
        }

        body {
            font-family: var(--font-family) !important;
            font-size: var(--font-size) !important;
            {% if ui_settings.ui_enable_rtl %}direction: rtl;{% endif %}
            {% if ui_settings.ui_enable_dark_mode %}
            background-color: #1a1a1a !important;
            color: #ffffff !important;
            {% endif %}
        }

        .btn-primary {
            background-color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }

        .btn-secondary {
            background-color: var(--secondary-color) !important;
            border-color: var(--secondary-color) !important;
        }

        .btn-success {
            background-color: var(--success-color) !important;
            border-color: var(--success-color) !important;
        }

        .btn-danger {
            background-color: var(--danger-color) !important;
            border-color: var(--danger-color) !important;
        }

        .btn-warning {
            background-color: var(--warning-color) !important;
            border-color: var(--warning-color) !important;
        }

        .btn-info {
            background-color: var(--info-color) !important;
            border-color: var(--info-color) !important;
        }

        .card, .modal-content, .dropdown-menu {
            border-radius: var(--border-radius) !important;
            {% if ui_settings.ui_enable_dark_mode %}
            background-color: #2d2d2d !important;
            border-color: #404040 !important;
            color: #ffffff !important;
            {% endif %}
        }

        .btn {
            border-radius: var(--border-radius) !important;
        }

        .form-control, .form-select {
            border-radius: var(--border-radius) !important;
            {% if ui_settings.ui_enable_dark_mode %}
            background-color: #404040 !important;
            border-color: #555555 !important;
            color: #ffffff !important;
            {% endif %}
        }

        {% if ui_settings.ui_table_striped %}
        .table-striped > tbody > tr:nth-of-type(odd) > td,
        .table-striped > tbody > tr:nth-of-type(odd) > th {
            background-color: rgba(0, 0, 0, 0.05) !important;
            {% if ui_settings.ui_enable_dark_mode %}
            background-color: rgba(255, 255, 255, 0.05) !important;
            {% endif %}
        }
        {% endif %}

        {% if ui_settings.ui_table_hover %}
        .table-hover > tbody > tr:hover > td,
        .table-hover > tbody > tr:hover > th {
            background-color: rgba(0, 0, 0, 0.075) !important;
            {% if ui_settings.ui_enable_dark_mode %}
            background-color: rgba(255, 255, 255, 0.075) !important;
            {% endif %}
        }
        {% endif %}

        {% if ui_settings.ui_compact_mode %}
        .card-body {
            padding: 0.75rem !important;
        }

        .btn {
            padding: 0.25rem 0.5rem !important;
            font-size: 0.875rem !important;
        }

        .form-control, .form-select {
            padding: 0.25rem 0.5rem !important;
            font-size: 0.875rem !important;
        }
        {% endif %}

        {% if not ui_settings.ui_enable_animations %}
        *, *::before, *::after {
            animation-duration: 0s !important;
            animation-delay: 0s !important;
            transition-duration: 0s !important;
            transition-delay: 0s !important;
        }
        {% endif %}

        {% if ui_settings.ui_enable_dark_mode %}
        .navbar, .sidebar {
            background-color: #2d2d2d !important;
        }

        .navbar-brand, .nav-link {
            color: #ffffff !important;
        }

        .dropdown-menu {
            background-color: #2d2d2d !important;
        }

        .dropdown-item {
            color: #ffffff !important;
        }

        .dropdown-item:hover {
            background-color: #404040 !important;
        }

        .table {
            color: #ffffff !important;
        }

        .table th {
            border-color: #404040 !important;
        }

        .table td {
            border-color: #404040 !important;
        }

        .text-muted {
            color: #aaaaaa !important;
        }

        .bg-light {
            background-color: #404040 !important;
        }

        .border {
            border-color: #555555 !important;
        }
        {% endif %}

        /* Additional System Settings Styles */

        /* RTL Support */
        .rtl-mode {
            direction: rtl;
            text-align: right;
        }

        .rtl-mode .sidebar {
            right: 0;
            left: auto;
        }

        .rtl-mode .main-content {
            margin-right: 280px;
            margin-left: 0;
        }

        /* Collapsed Sidebar */
        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar.collapsed .navbar-brand {
            display: none;
        }

        .sidebar.collapsed .nav-link span {
            display: none;
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }

            .company-header {
                page-break-inside: avoid;
            }

            .invoice-footer {
                page-break-inside: avoid;
            }
        }

        /* Currency Display */
        .currency {
            font-weight: 600;
            color: var(--success-color);
        }

        /* Tax Display */
        .tax-amount {
            color: var(--warning-color);
            font-size: 0.9em;
        }

        /* Barcode Container */
        .barcode-container {
            text-align: center;
            margin: 10px 0;
        }

        .barcode-container canvas {
            max-width: 100%;
        }

        /* Compact Mode Enhancements */
        .compact-mode .card {
            margin-bottom: 15px;
        }

        .compact-mode .card-body {
            padding: 15px;
        }

        .compact-mode .btn {
            padding: 6px 12px;
            font-size: 0.875rem;
        }

        .compact-mode .table td,
        .compact-mode .table th {
            padding: 8px;
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-expand-lg top-navbar
         {% if user_taskbar_settings %}
             taskbar-{{ user_taskbar_settings.position|lower }}
             taskbar-theme-{{ user_taskbar_settings.theme }}
             taskbar-size-{{ user_taskbar_settings.size }}
             {% if user_taskbar_settings.auto_hide %}taskbar-auto-hide{% endif %}
         {% endif %}">
        <div class="container-fluid">
            <button class="navbar-toggler d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="navbar-brand d-lg-none">
                {% if company_logo_url %}
                    <img src="{{ company_logo_url }}" alt="Logo" width="25" height="25" class="me-2">
                {% else %}
                    <i class="fas fa-calculator me-2"></i>
                {% endif %}
                {{ company_name|default:"حسابات أوساريك" }}
            </div>
            
            <!-- Company Logo - أقصى اليمين -->
            <div class="company-logo-header d-none d-lg-block">
                <a href="{% url 'dashboard:home' %}" class="text-decoration-none">
                    {% if company_logo_url %}
                        <img src="{{ company_logo_url }}"
                             alt="{{ company_name|default:'شعار الشركة' }}"
                             class="header-logo"
                             data-bs-toggle="tooltip"
                             title="العودة للصفحة الرئيسية - {{ company_name|default:'شعار الشركة' }}">
                    {% else %}
                        <div class="header-logo-placeholder"
                             data-bs-toggle="tooltip"
                             title="العودة للصفحة الرئيسية - {{ company_name|default:'شعار الشركة' }}">
                            <i class="fas fa-building"></i>
                        </div>
                    {% endif %}
                </a>
            </div>

            <div class="ms-auto d-flex align-items-center gap-3" style="margin-right: 180px;">
                <!-- Date and Time -->
                <div class="datetime-display d-none d-md-block">
                    <i class="fas fa-calendar-alt me-2"></i>
                    <span id="current-datetime"></span>
                </div>

                <!-- Global Search Bar -->
                <div class="global-search-container position-relative">
                    <div class="input-group">
                        <input type="text"
                               id="globalSearchInput"
                               class="form-control global-search-input"
                               placeholder="البحث في النظام... (Ctrl+K)"
                               autocomplete="off">
                        <button class="btn btn-outline-primary" type="button" id="globalSearchBtn">
                            <i class="fas fa-search"></i>
                        </button>
                        <div class="search-shortcut-hint position-absolute">
                            <small class="text-muted">Ctrl+K</small>
                        </div>
                    </div>

                    <!-- Search Results Dropdown -->
                    <div id="globalSearchResults" class="global-search-results position-absolute w-100 d-none">
                        <div class="search-loading text-center p-3 d-none">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">جاري البحث...</span>
                            </div>
                            <div class="mt-2">جاري البحث...</div>
                        </div>

                        <div class="search-content">
                            <!-- Search results will be populated here -->
                        </div>

                        <div class="search-no-results text-center p-3 text-muted d-none">
                            <i class="fas fa-search-minus fa-2x mb-2"></i>
                            <div>لا توجد نتائج للبحث</div>
                        </div>
                    </div>
                </div>
                
                <!-- License Status -->
                {% if system_license %}
                <div class="license-info me-3">
                    <div class="license-status
                        {% if system_license.is_expired %}license-expired
                        {% elif system_license.days_remaining < 7 %}license-warning
                        {% else %}license-active{% endif %}">
                        <i class="fas fa-certificate me-1"></i>
                        {% if system_license.is_expired %}
                            منتهي الصلاحية
                        {% else %}
                            {{ system_license.days_remaining }} يوم
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- User Info -->
                <div class="user-info">
                    <a href="{% url 'accounts:profile' %}" class="text-decoration-none text-dark d-flex align-items-center gap-2">
                        <div class="user-avatar">
                            {% if user.first_name %}
                                {{ user.first_name|first }}{{ user.last_name|first }}
                            {% else %}
                                {{ user.username|first|upper }}
                            {% endif %}
                        </div>
                        <div class="d-none d-md-block">
                            <div class="fw-bold">{{ user.get_full_name|default:user.username }}</div>
                            <small class="text-muted">مرحباً بك</small>
                        </div>
                    </a>
                </div>
                
                <!-- Logout -->
                <a href="{% url 'accounts:logout' %}" class="btn btn-outline-danger btn-sm">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="d-none d-md-inline">خروج</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
                <div class="p-3">
                    <div class="navbar-brand text-white mb-4">
                        {% if company_logo_url %}
                            <img src="{{ company_logo_url }}" alt="Logo" width="30" height="30" class="me-2">
                        {% else %}
                            <i class="fas fa-calculator me-2"></i>
                        {% endif %}
                        {{ company_name|default:"حسابات أوساريك" }}
                    </div>

                    <!-- Mobile Search Bar -->
                    <div class="mobile-search-container mb-3 d-lg-none">
                        <div class="text-center mb-2">
                            <small class="text-light opacity-75">
                                <i class="fas fa-search me-1"></i>
                                البحث السريع في النظام
                            </small>
                        </div>
                        <div class="input-group">
                            <input type="text"
                                   id="mobileSearchInput"
                                   class="form-control"
                                   placeholder="البحث في النظام..."
                                   autocomplete="off">
                            <button class="btn btn-light" type="button" id="mobileSearchBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>

                        <!-- Mobile Search Results -->
                        <div id="mobileSearchResults" class="mobile-search-results d-none">
                            <div class="search-loading text-center p-3 d-none">
                                <div class="spinner-border spinner-border-sm text-light" role="status">
                                    <span class="visually-hidden">جاري البحث...</span>
                                </div>
                                <div class="mt-2 text-light">جاري البحث...</div>
                            </div>

                            <div class="search-content">
                                <!-- Search results will be populated here -->
                            </div>

                            <div class="search-no-results text-center p-3 text-light d-none">
                                <i class="fas fa-search-minus fa-2x mb-2"></i>
                                <div>لا توجد نتائج للبحث</div>
                            </div>
                        </div>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item" data-menu-id="dashboard">
                            <a class="nav-link" href="{% url 'dashboard:home' %}">
                                <i class="fas fa-tachometer-alt"></i>
                                <span class="item-text">لوحة التحكم</span>
                            </a>
                        </li>
                        
                        <li class="nav-item" data-menu-id="definitions">
                            <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#definitions-menu">
                                <i class="fas fa-cogs"></i>
                                <span class="item-text">التعريفات</span>
                                <i class="fas fa-chevron-down ms-auto"></i>
                            </a>
                            <div class="collapse" id="definitions-menu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:home' %}">
                                            <i class="fas fa-home"></i>
                                            الرئيسية
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:currency_list' %}">
                                            <i class="fas fa-coins"></i>
                                            العملات
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:warehouse_list' %}">
                                            <i class="fas fa-warehouse"></i>
                                            المخازن
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:category_list' %}">
                                            <i class="fas fa-tags"></i>
                                            فئات الأصناف
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:unit_list' %}">
                                            <i class="fas fa-ruler"></i>
                                            وحدات القياس
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:item_list' %}">
                                            <i class="fas fa-boxes"></i>
                                            الأصناف
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:bank_list' %}">
                                            <i class="fas fa-university"></i>
                                            البنوك
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:treasury_list' %}">
                                            <i class="fas fa-cash-register"></i>
                                            الخزائن
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:zone_list' %}">
                                            <i class="fas fa-map-marked-alt"></i>
                                            مناطق المخازن
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:location_list' %}">
                                            <i class="fas fa-map-pin"></i>
                                            مواقع المخازن
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:item_location_list' %}">
                                            <i class="fas fa-sitemap"></i>
                                            مواقع الأصناف
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:asset_group_list' %}">
                                            <i class="fas fa-layer-group"></i>
                                            مجموعات الأصول
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:person_list' %}">
                                            <i class="fas fa-users"></i>
                                            الأشخاص والجهات
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:expense_category_list' %}">
                                            <i class="fas fa-money-bill-wave"></i>
                                            فئات المصروفات
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:expense_item_list' %}">
                                            <i class="fas fa-receipt"></i>
                                            بنود المصروفات
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:revenue_category_list' %}">
                                            <i class="fas fa-coins"></i>
                                            فئات الإيرادات
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:revenue_item_list' %}">
                                            <i class="fas fa-hand-holding-usd"></i>
                                            بنود الإيرادات
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:company_settings' %}">
                                            <i class="fas fa-building"></i>
                                            إعدادات الشركة
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>

                        <!-- Production Management -->
                        <li class="nav-item">
                            <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#productionCollapse">
                                <i class="fas fa-industry"></i>
                                <span>إدارة الإنتاج</span>
                                <i class="fas fa-chevron-down ms-auto"></i>
                            </a>
                            <div class="collapse" id="productionCollapse">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:production_stage_list' %}">
                                            <i class="fas fa-cogs"></i>
                                            مراحل الإنتاج
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:finished_product_list' %}">
                                            <i class="fas fa-box"></i>
                                            المنتجات التامة
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'definitions:profit_center_list' %}">
                                            <i class="fas fa-chart-pie"></i>
                                            مراكز الربحية
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'definitions:printer_list' %}">
                                <i class="fas fa-print"></i>
                                الطابعات
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'sales:home' %}">
                                <i class="fas fa-shopping-cart"></i>
                                المبيعات
                            </a>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'purchases:home' %}">
                                <i class="fas fa-truck"></i>
                                المشتريات
                            </a>
                        </li>
                        
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="warehouseDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-box"></i>
                                المخازن
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="warehouseDropdown">
                                <li>
                                    <a class="dropdown-item" href="{% url 'definitions:warehouse_list' %}">
                                        <i class="fas fa-warehouse me-2"></i>
                                        إدارة المخازن
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:stock_increase_list' %}">
                                        <i class="fas fa-plus-circle me-2 text-success"></i>
                                        إذن إضافة الزيادات
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:stock_decrease_list' %}">
                                        <i class="fas fa-minus-circle me-2 text-danger"></i>
                                        إذن صرف النواقص
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:goods_received_on_loan_list' %}">
                                        <i class="fas fa-arrow-down me-2 text-info"></i>
                                        بضاعة مضافة سلفة من الغير
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:goods_issued_on_loan_list' %}">
                                        <i class="fas fa-arrow-up me-2 text-warning"></i>
                                        بضاعة منصرفة سلفة لدى الغير
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:warehouse_transfer_list' %}">
                                        <i class="fas fa-exchange-alt me-2 text-primary"></i>
                                        تحويل بين المخازن
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:item_transformation_list' %}">
                                        <i class="fas fa-recycle me-2 text-success"></i>
                                        التحويل من صنف إلى صنف
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:manufacturing_order_list' %}">
                                        <i class="fas fa-industry me-2 text-primary"></i>
                                        إنتاج تام تصنيع
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:physical_inventory_list' %}">
                                        <i class="fas fa-clipboard-check me-2 text-info"></i>
                                        الجرد الفعلي وتسجيل الفرق
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'inventory:opening_inventory_list' %}">
                                        <i class="fas fa-clipboard-list me-2 text-success"></i>
                                        الجرد الافتتاحي (أول المدة)
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>

                            </ul>
                        </li>
                        
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'definitions:bank_list' %}">
                                <i class="fas fa-university"></i>
                                البنوك
                            </a>
                        </li>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="treasuryDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-cash-register"></i>
                                الخزينة
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="treasuryDropdown">
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:home' %}">
                                        <i class="fas fa-home me-2 text-primary"></i>
                                        لوحة تحكم الخزينة
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:receipt_list' %}">
                                        <i class="fas fa-hand-holding-usd me-2 text-success"></i>
                                        تحصيل نقدي
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:payment_list' %}">
                                        <i class="fas fa-money-bill-wave me-2 text-danger"></i>
                                        دفع نقدي
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:receipt_note_list' %}">
                                        <i class="fas fa-file-invoice me-2 text-info"></i>
                                        أوراق قبض
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:payment_note_list' %}">
                                        <i class="fas fa-file-invoice-dollar me-2 text-warning"></i>
                                        أوراق دفع
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:custody_in_list' %}">
                                        <i class="fas fa-inbox me-2 text-primary"></i>
                                        إيصالات أمانة واردة
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:custody_out_list' %}">
                                        <i class="fas fa-share me-2 text-secondary"></i>
                                        إيصالات أمانة صادرة
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:revenue_list' %}">
                                        <i class="fas fa-plus-circle me-2 text-success"></i>
                                        إيرادات
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:expense_list' %}">
                                        <i class="fas fa-minus-circle me-2 text-danger"></i>
                                        مصروفات
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'treasury:transfer_list' %}">
                                        <i class="fas fa-exchange-alt me-2 text-info"></i>
                                        تحويل بين الخزائن
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="assetsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-building"></i>
                                الأصول الثابتة
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="assetsDropdown">
                                <li>
                                    <a class="dropdown-item" href="{% url 'assets:home' %}">
                                        <i class="fas fa-home me-2 text-success"></i>
                                        لوحة تحكم الأصول
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'assets:asset_purchase_list' %}">
                                        <i class="fas fa-shopping-cart me-2 text-primary"></i>
                                        شراء أصول
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'assets:asset_renewal_list' %}">
                                        <i class="fas fa-sync-alt me-2 text-info"></i>
                                        تجديد أصول
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'assets:asset_sale_list' %}">
                                        <i class="fas fa-hand-holding-usd me-2 text-warning"></i>
                                        بيع أصول
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'assets:depreciation_list' %}">
                                        <i class="fas fa-calculator me-2 text-danger"></i>
                                        حساب الإهلاك
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'assets:asset_list' %}">
                                        <i class="fas fa-list me-2 text-secondary"></i>
                                        قائمة الأصول
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'assets:asset_reports' %}">
                                        <i class="fas fa-chart-line me-2 text-purple"></i>
                                        تقارير الأصول
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- المقرات والفروع -->
                        <li class="nav-item dropdown easy-dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="branchesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-sitemap me-2 text-success"></i>
                                المقرات والفروع
                            </a>
                            <div class="dropdown-menu easy-dropdown-menu" aria-labelledby="branchesDropdown">
                                <!-- لوحة تحكم الفروع -->
                                <div class="easy-dropdown-section theme-success">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-tachometer-alt"></i>
                                        لوحة تحكم الفروع
                                    </div>
                                    <a href="{% url 'branches:home' %}" class="easy-dropdown-item">
                                        <i class="fas fa-home"></i>
                                        <span class="item-text">لوحة تحكم الفروع</span>
                                        <span class="item-badge">رئيسي</span>
                                    </a>
                                </div>

                                <!-- تعريف الفروع -->
                                <div class="easy-dropdown-section theme-primary">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-building"></i>
                                        تعريف الفروع
                                    </div>
                                    <a href="{% url 'branches:branch_list' %}" class="easy-dropdown-item">
                                        <i class="fas fa-list"></i>
                                        <span class="item-text">قائمة الفروع</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:branch_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة فرع جديد</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                </div>

                                <!-- الأرصدة الافتتاحية -->
                                <div class="easy-dropdown-section theme-info">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-balance-scale"></i>
                                        الأرصدة الافتتاحية
                                    </div>
                                    <a href="{% url 'branches:opening_balance' %}" class="easy-dropdown-item">
                                        <i class="fas fa-calculator"></i>
                                        <span class="item-text">أرصدة افتتاحية للفروع</span>
                                        <span class="item-badge">أرصدة</span>
                                    </a>
                                </div>

                                <!-- البضائع المحولة -->
                                <div class="easy-dropdown-section theme-warning">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-exchange-alt"></i>
                                        البضائع المحولة
                                    </div>
                                    <a href="{% url 'branches:goods_transfer' %}" class="easy-dropdown-item">
                                        <i class="fas fa-truck"></i>
                                        <span class="item-text">تحويل البضائع بين الفروع</span>
                                        <span class="item-badge">تحويل</span>
                                    </a>
                                </div>

                                <!-- التحويلات النقدية -->
                                <div class="easy-dropdown-section theme-danger">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-money-bill-transfer"></i>
                                        التحويلات النقدية
                                    </div>
                                    <a href="{% url 'branches:cash_received' %}" class="easy-dropdown-item">
                                        <i class="fas fa-hand-holding-usd"></i>
                                        <span class="item-text">تحويل نقدي بين خزائن الفروع</span>
                                        <span class="item-badge">نقدي</span>
                                    </a>
                                </div>

                                <!-- التحويلات البنكية -->
                                <div class="easy-dropdown-section theme-purple">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-university"></i>
                                        التحويلات البنكية
                                    </div>
                                    <a href="{% url 'branches:bank_deposits_from_branches' %}" class="easy-dropdown-item">
                                        <i class="fas fa-credit-card"></i>
                                        <span class="item-text">إيداع وسحب بنكي بين الفروع</span>
                                        <span class="item-badge">بنكي</span>
                                    </a>
                                </div>

                                <!-- إيرادات التحصيل -->
                                <div class="easy-dropdown-section theme-success">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-coins"></i>
                                        إيرادات التحصيل
                                    </div>
                                    <a href="{% url 'branches:collection_revenues' %}" class="easy-dropdown-item">
                                        <i class="fas fa-chart-line"></i>
                                        <span class="item-text">إيرادات تحصيل الفروع</span>
                                        <span class="item-badge">إيرادات</span>
                                    </a>
                                </div>

                                <!-- المصروفات المدفوعة -->
                                <div class="easy-dropdown-section theme-danger">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-receipt"></i>
                                        المصروفات المدفوعة
                                    </div>
                                    <a href="{% url 'branches:branch_expenses' %}" class="easy-dropdown-item">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <span class="item-text">مصروفات مدفوعة محملة على الفروع</span>
                                        <span class="item-badge">مصروفات</span>
                                    </a>
                                </div>
                            </div>
                        </li>

                        <!-- الحسابات العامة -->
                        <li class="nav-item dropdown easy-dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="accountingDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-calculator me-2 text-purple"></i>
                                الحسابات العامة
                            </a>
                            <div class="dropdown-menu easy-dropdown-menu" aria-labelledby="accountingDropdown">
                                <!-- لوحة تحكم الحسابات العامة -->
                                <div class="easy-dropdown-section theme-purple">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-tachometer-alt"></i>
                                        لوحة تحكم الحسابات العامة
                                    </div>
                                    <a href="{% url 'accounting:accounting_dashboard' %}" class="easy-dropdown-item">
                                        <i class="fas fa-home"></i>
                                        <span class="item-text">لوحة تحكم الحسابات العامة</span>
                                        <span class="item-badge">رئيسي</span>
                                    </a>
                                </div>

                                <!-- تحويل رصيد بين الأشخاص -->
                                <div class="easy-dropdown-section theme-primary">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-exchange-alt"></i>
                                        تحويل رصيد بين الأشخاص
                                    </div>
                                    <a href="{% url 'accounting:balance_transfer' %}" class="easy-dropdown-item">
                                        <i class="fas fa-arrow-right-arrow-left"></i>
                                        <span class="item-text">تحويل رصيد بين الأشخاص</span>
                                        <span class="item-badge">تحويل</span>
                                    </a>
                                </div>

                                <!-- دمج الحسابات الفرعية -->
                                <div class="easy-dropdown-section theme-info">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-compress-arrows-alt"></i>
                                        دمج الحسابات الفرعية
                                    </div>
                                    <a href="{% url 'accounting:merge_accounts' %}" class="easy-dropdown-item">
                                        <i class="fas fa-compress"></i>
                                        <span class="item-text">دمج الحسابات الفرعية للأشخاص</span>
                                        <span class="item-badge">دمج</span>
                                    </a>
                                </div>

                                <!-- القيود المحاسبية -->
                                <div class="easy-dropdown-section theme-success">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-book"></i>
                                        القيود المحاسبية
                                    </div>
                                    <a href="{% url 'accounting:journal_entries' %}" class="easy-dropdown-item">
                                        <i class="fas fa-list"></i>
                                        <span class="item-text">عرض القيود المحاسبية</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'accounting:journal_entry_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة قيد محاسبي</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                </div>

                                <!-- القيد الافتتاحي -->
                                <div class="easy-dropdown-section theme-warning">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-play-circle"></i>
                                        القيد الافتتاحي
                                    </div>
                                    <a href="{% url 'accounting:opening_balance' %}" class="easy-dropdown-item">
                                        <i class="fas fa-eye"></i>
                                        <span class="item-text">عرض القيد الافتتاحي</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'accounting:opening_balance_setup' %}" class="easy-dropdown-item">
                                        <i class="fas fa-cog"></i>
                                        <span class="item-text">إعداد القيد الافتتاحي</span>
                                        <span class="item-badge">إعداد</span>
                                    </a>
                                    <a href="{% url 'inventory:opening_inventory_list' %}" class="easy-dropdown-item">
                                        <i class="fas fa-clipboard-list"></i>
                                        <span class="item-text">جرد بضاعة أول المدة</span>
                                        <span class="item-badge">مخزون</span>
                                    </a>
                                </div>

                                <!-- الحساب الختامي -->
                                <div class="easy-dropdown-section theme-danger">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-chart-pie"></i>
                                        الحساب الختامي
                                    </div>
                                    <a href="{% url 'accounting:profit_centers' %}" class="easy-dropdown-item">
                                        <i class="fas fa-bullseye"></i>
                                        <span class="item-text">مراكز الربحية</span>
                                        <span class="item-badge">تقرير</span>
                                    </a>
                                    <a href="{% url 'accounting:income_statement' %}" class="easy-dropdown-item">
                                        <i class="fas fa-chart-line"></i>
                                        <span class="item-text">قائمة الدخل</span>
                                        <span class="item-badge">تقرير</span>
                                    </a>
                                    <a href="{% url 'accounting:balance_sheet' %}" class="easy-dropdown-item">
                                        <i class="fas fa-balance-scale"></i>
                                        <span class="item-text">المركز المالي</span>
                                        <span class="item-badge">تقرير</span>
                                    </a>
                                    <a href="{% url 'accounting:profit_distribution' %}" class="easy-dropdown-item">
                                        <i class="fas fa-share-alt"></i>
                                        <span class="item-text">توزيع الأرباح</span>
                                        <span class="item-badge">توزيع</span>
                                    </a>
                                    <a href="{% url 'accounting:period_closure' %}" class="easy-dropdown-item">
                                        <i class="fas fa-calendar-times"></i>
                                        <span class="item-text">إنهاء فترة الحسابات</span>
                                        <span class="item-badge">إنهاء</span>
                                    </a>
                                </div>
                            </div>
                        </li>

                        <!-- المركز الرئيسي والفروع -->
                        <li class="nav-item dropdown easy-dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="branchesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-sitemap me-2 text-success"></i>
                                المركز الرئيسي والفروع
                            </a>
                            <div class="dropdown-menu" aria-labelledby="branchesDropdown">
                                <!-- الإدارة العامة -->
                                <div class="easy-dropdown-section theme-success">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-cogs"></i>
                                        الإدارة العامة
                                    </div>
                                    <a href="{% url 'branches:home' %}" class="easy-dropdown-item">
                                        <i class="fas fa-home"></i>
                                        <span class="item-text">لوحة تحكم الفروع</span>
                                        <span class="item-badge">رئيسي</span>
                                    </a>
                                    <a href="{% url 'branches:branch_list' %}" class="easy-dropdown-item">
                                        <i class="fas fa-building"></i>
                                        <span class="item-text">تعريف الفروع</span>
                                        <span class="item-badge">إعداد</span>
                                    </a>
                                    <a href="{% url 'branches:opening_balance' %}" class="easy-dropdown-item">
                                        <i class="fas fa-play-circle"></i>
                                        <span class="item-text">القيد الافتتاحي</span>
                                        <span class="item-badge">مالي</span>
                                    </a>
                                    <a href="{% url 'branches:goods_transfer' %}" class="easy-dropdown-item">
                                        <i class="fas fa-truck"></i>
                                        <span class="item-text">بضاعة مرحلة للفروع</span>
                                        <span class="item-badge">نقل</span>
                                    </a>
                                </div>
                                <!-- النقدية - الخزائن -->
                                <div class="easy-dropdown-section theme-primary">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-money-bill-wave"></i>
                                        النقدية - الخزائن
                                    </div>
                                    <a href="{% url 'branches:cash_received' %}" class="easy-dropdown-item">
                                        <i class="fas fa-arrow-down"></i>
                                        <span class="item-text">نقدية واردة للخزينة</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:cash_received_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة نقدية واردة</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                    <a href="{% url 'branches:cash_sent' %}" class="easy-dropdown-item">
                                        <i class="fas fa-arrow-up"></i>
                                        <span class="item-text">نقدية صادرة من الخزينة</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:cash_sent_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة نقدية صادرة</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                    <a href="{% url 'branches:cash_treasury_demo' %}" class="easy-dropdown-item">
                                        <i class="fas fa-info-circle"></i>
                                        <span class="item-text">دليل الاستخدام</span>
                                        <span class="item-badge">مساعدة</span>
                                    </a>
                                </div>

                                <!-- البنوك - خزائن الفروع -->
                                <div class="easy-dropdown-section theme-info">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-university"></i>
                                        البنوك - خزائن الفروع
                                    </div>
                                    <a href="{% url 'branches:bank_deposits_from_branches' %}" class="easy-dropdown-item">
                                        <i class="fas fa-arrow-down"></i>
                                        <span class="item-text">إيداعات بنكية واردة</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:bank_deposits_from_branches_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة إيداع جديد</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                    <a href="{% url 'branches:bank_withdrawals_to_branches' %}" class="easy-dropdown-item">
                                        <i class="fas fa-arrow-up"></i>
                                        <span class="item-text">مسحوبات بنكية صادرة</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:bank_withdrawals_to_branches_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة مسحوب جديد</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                </div>

                                <!-- البنوك - بنوك الفروع -->
                                <div class="easy-dropdown-section theme-warning">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-exchange-alt"></i>
                                        البنوك - بنوك الفروع
                                    </div>
                                    <a href="{% url 'branches:bank_deposits_from_branch_banks' %}" class="easy-dropdown-item">
                                        <i class="fas fa-arrow-down"></i>
                                        <span class="item-text">تحويلات واردة</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:bank_deposits_from_branch_banks_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة تحويل وارد</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                    <a href="{% url 'branches:bank_withdrawals_to_branch_banks' %}" class="easy-dropdown-item">
                                        <i class="fas fa-arrow-up"></i>
                                        <span class="item-text">تحويلات صادرة</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:bank_withdrawals_to_branch_banks_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة تحويل صادر</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                </div>

                                <!-- الإيرادات التحصيلية -->
                                <div class="easy-dropdown-section theme-danger">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-hand-holding-usd"></i>
                                        الإيرادات التحصيلية
                                    </div>
                                    <a href="{% url 'branches:collection_revenues' %}" class="easy-dropdown-item">
                                        <i class="fas fa-list"></i>
                                        <span class="item-text">عرض الإيرادات التحصيلية</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:collection_revenues_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة إيراد تحصيلي</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                </div>

                                <!-- المصروفات المحملة على الفروع -->
                                <div class="easy-dropdown-section theme-secondary">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-receipt"></i>
                                        المصروفات المحملة على الفروع
                                    </div>
                                    <a href="{% url 'branches:branch_expenses' %}" class="easy-dropdown-item">
                                        <i class="fas fa-list"></i>
                                        <span class="item-text">عرض المصروفات المحملة</span>
                                        <span class="item-badge">عرض</span>
                                    </a>
                                    <a href="{% url 'branches:branch_expenses_add' %}" class="easy-dropdown-item">
                                        <i class="fas fa-plus"></i>
                                        <span class="item-text">إضافة مصروف محمل</span>
                                        <span class="item-badge">جديد</span>
                                    </a>
                                </div>

                                <!-- التقارير المتخصصة -->
                                <div class="easy-dropdown-section theme-dark">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-chart-line"></i>
                                        التقارير المتخصصة
                                    </div>
                                    <a href="{% url 'branches:branch_account_statement' %}" class="easy-dropdown-item">
                                        <i class="fas fa-file-alt"></i>
                                        <span class="item-text">كشف حساب فرع</span>
                                        <span class="item-badge">تقرير</span>
                                    </a>
                                    <a href="{% url 'branches:branches_balances_report' %}" class="easy-dropdown-item">
                                        <i class="fas fa-balance-scale"></i>
                                        <span class="item-text">تقرير أرصدة الفروع</span>
                                        <span class="item-badge">تقرير</span>
                                    </a>
                                    <a href="{% url 'branches:branch_notifications_report' %}" class="easy-dropdown-item">
                                        <i class="fas fa-bell"></i>
                                        <span class="item-text">إشعارات العمليات</span>
                                        <span class="item-badge">تقرير</span>
                                    </a>
                                </div>
                            </div>
                        </li>

                        <!-- شؤون العاملين -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="hrDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-users me-2 text-info"></i>
                                شؤون العاملين
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="hrDropdown">
                                <li>
                                    <a class="dropdown-item" href="{% url 'hr:dashboard' %}">
                                        <i class="fas fa-home me-2 text-info"></i>
                                        لوحة تحكم شؤون العاملين
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <!-- الإعدادات الأساسية -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-cogs me-2 text-primary"></i>
                                        الإعدادات الأساسية
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="{% url 'hr:salary_system_list' %}">
                                                <i class="fas fa-money-bill me-2"></i>
                                                أنظمة صرف المرتب
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'hr:department_list' %}">
                                                <i class="fas fa-sitemap me-2"></i>
                                                الأقسام
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'hr:employee_list' %}">
                                                <i class="fas fa-user-tie me-2"></i>
                                                العاملين
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-cog me-2"></i>
                                                الإضافات والخصومات
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <!-- الإضافات للمرتبات -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-plus me-2 text-success"></i>
                                        الإضافات للمرتبات
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-plus-circle me-2"></i>
                                                إضافات ثابتة
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-chart-line me-2"></i>
                                                إضافات متغيرة
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-clock me-2"></i>
                                                ساعات عمل خارجي
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-calculator me-2"></i>
                                                حاسبة الإضافات
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <!-- الخصومات من المرتبات -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-minus me-2 text-danger"></i>
                                        الخصومات من المرتبات
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-minus-circle me-2"></i>
                                                خصومات ثابتة
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-chart-line-down me-2"></i>
                                                خصومات متغيرة
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                خصومات جزائية
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-file-invoice me-2"></i>
                                                تقارير الخصومات
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <h6 class="dropdown-header">العمليات الشهرية</h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-hand-holding-usd me-2 text-warning"></i>
                                        سلف العاملين
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-calendar-plus me-2 text-primary"></i>
                                        إضافة شهر جديد
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-calculator me-2 text-success"></i>
                                        حساب المرتب
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <h6 class="dropdown-header">التقارير</h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-users me-2 text-info"></i>
                                        تقرير بالعاملين
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-book me-2 text-primary"></i>
                                        يوميات شؤون العاملين
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-money-check-alt me-2 text-success"></i>
                                        تقارير المرتبات
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- الخدمات -->
                        <li class="nav-item dropdown easy-dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="servicesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-cogs me-2 text-secondary"></i>
                                الخدمات
                            </a>
                            <div class="dropdown-menu easy-dropdown-menu" aria-labelledby="servicesDropdown">
                                <!-- لوحة تحكم الخدمات -->
                                <div class="easy-dropdown-section theme-secondary">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-tachometer-alt"></i>
                                        لوحة تحكم الخدمات
                                    </div>
                                    <a href="{% url 'services:services_dashboard' %}" class="easy-dropdown-item">
                                        <i class="fas fa-home"></i>
                                        <span class="item-text">لوحة تحكم الخدمات</span>
                                        <span class="item-badge">رئيسي</span>
                                    </a>
                                </div>

                                <!-- إدارة البيانات -->
                                <div class="easy-dropdown-section theme-danger">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-database"></i>
                                        إدارة البيانات
                                    </div>
                                    <a href="{% url 'services:delete_data' %}" class="easy-dropdown-item">
                                        <i class="fas fa-trash-alt"></i>
                                        <span class="item-text">حذف البيانات المسجلة</span>
                                        <span class="item-badge">حذف</span>
                                    </a>
                                    <a href="{% url 'services:recycle_bin' %}" class="easy-dropdown-item">
                                        <i class="fas fa-recycle"></i>
                                        <span class="item-text">سلة المحذوفات</span>
                                        <span class="item-badge">استرداد</span>
                                    </a>
                                    <a href="{% url 'services:edit_history' %}" class="easy-dropdown-item">
                                        <i class="fas fa-history"></i>
                                        <span class="item-text">سلة التعديلات</span>
                                        <span class="item-badge">تاريخ</span>
                                    </a>
                                </div>

                                <!-- النسخ الاحتياطي والترخيص -->
                                <div class="easy-dropdown-section theme-info">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-shield-alt"></i>
                                        النسخ الاحتياطي والترخيص
                                    </div>
                                    <a href="{% url 'services:backup' %}" class="easy-dropdown-item">
                                        <i class="fas fa-download"></i>
                                        <span class="item-text">نسخ احتياطي</span>
                                        <span class="item-badge">حفظ</span>
                                    </a>
                                    <a href="{% url 'services:license' %}" class="easy-dropdown-item">
                                        <i class="fas fa-certificate"></i>
                                        <span class="item-text">ترخيص النسخة</span>
                                        <span class="item-badge">ترخيص</span>
                                    </a>
                                </div>

                                <!-- أدوات النظام -->
                                <div class="easy-dropdown-section theme-warning">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-tools"></i>
                                        أدوات النظام
                                    </div>
                                    <a href="{% url 'services:recalculate_costs' %}" class="easy-dropdown-item">
                                        <i class="fas fa-calculator"></i>
                                        <span class="item-text">إعادة حساب أسعار التكلفة</span>
                                        <span class="item-badge">حساب</span>
                                    </a>
                                    <a href="{% url 'services:taskbar_settings' %}" class="easy-dropdown-item">
                                        <i class="fas fa-window-maximize"></i>
                                        <span class="item-text">شريط المهام</span>
                                        <span class="item-badge">إعداد</span>
                                    </a>
                                </div>

                                <!-- الإعدادات والأمان -->
                                <div class="easy-dropdown-section theme-success">
                                    <div class="easy-dropdown-header">
                                        <i class="fas fa-user-shield"></i>
                                        الإعدادات والأمان
                                    </div>
                                    <a href="{% url 'services:system_settings' %}" class="easy-dropdown-item">
                                        <i class="fas fa-cog"></i>
                                        <span class="item-text">كلمات السر وخيارات البرنامج</span>
                                        <span class="item-badge">إعداد</span>
                                    </a>
                                    <a href="{% url 'services:financial_settings' %}" class="easy-dropdown-item">
                                        <i class="fas fa-coins"></i>
                                        <span class="item-text">الإعدادات المالية</span>
                                        <span class="item-badge">عملة</span>
                                    </a>
                                    <a href="{% url 'services:print_design' %}" class="easy-dropdown-item">
                                        <i class="fas fa-print"></i>
                                        <span class="item-text">تصميم نماذج الطباعة</span>
                                        <span class="item-badge">تصميم</span>
                                    </a>
                                    <a href="{% url 'services:barcode_design' %}" class="easy-dropdown-item">
                                        <i class="fas fa-barcode"></i>
                                        <span class="item-text">تصميم نماذج الباركود</span>
                                        <span class="item-badge">تصميم</span>
                                    </a>
                                    <a href="{% url 'services:relogin' %}" class="easy-dropdown-item">
                                        <i class="fas fa-sign-in-alt"></i>
                                        <span class="item-text">إعادة الدخول كمستخدم</span>
                                        <span class="item-badge">دخول</span>
                                    </a>
                                </div>
                            </div>
                        </li>

                        <!-- التقارير -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="reportsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-chart-bar me-2 text-warning"></i>
                                التقارير
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="reportsDropdown">
                                <!-- لوحة تحكم التقارير -->
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:dashboard' %}">
                                        <i class="fas fa-tachometer-alt me-2 text-primary"></i>
                                        <strong>لوحة تحكم التقارير</strong>
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>

                                <!-- تقارير الأشخاص -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-users me-2 text-primary"></i>
                                        الأشخاص
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:person_account_statement_invoices' %}">
                                        <i class="fas fa-file-invoice me-2 text-info"></i>
                                        كشف حساب حسب الفواتير
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:person_account_statement_detailed' %}">
                                        <i class="fas fa-file-alt me-2 text-info"></i>
                                        كشف حساب شخص تفصيلي
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:persons_balances' %}">
                                        <i class="fas fa-balance-scale me-2 text-success"></i>
                                        أرصدة الأشخاص
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:persons_directory' %}">
                                        <i class="fas fa-address-book me-2 text-primary"></i>
                                        دليل الأشخاص
                                    </a>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- تقارير الخزينة -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-cash-register me-2 text-success"></i>
                                        الخزينة
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:cash_payments_report' %}">
                                        <i class="fas fa-hand-holding-usd me-2 text-danger"></i>
                                        دفع نقدي
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:payment_papers_report' %}">
                                        <i class="fas fa-file-contract me-2 text-warning"></i>
                                        أوراق دفع
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:outgoing_custody_receipts_report' %}">
                                        <i class="fas fa-receipt me-2 text-info"></i>
                                        إيصالات أمانة صادرة
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:expenses_report' %}">
                                        <i class="fas fa-money-bill-wave me-2 text-danger"></i>
                                        مصروفات
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:monthly_expenses_report' %}">
                                        <i class="fas fa-calendar-alt me-2 text-danger"></i>
                                        مصروفات شهرية
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:cash_collections_report' %}">
                                        <i class="fas fa-coins me-2 text-success"></i>
                                        تحصيل نقدي
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:collection_papers_report' %}">
                                        <i class="fas fa-file-invoice-dollar me-2 text-success"></i>
                                        أوراق قبض
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:incoming_custody_receipts_report' %}">
                                        <i class="fas fa-receipt me-2 text-primary"></i>
                                        إيصالات أمانة واردة
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:revenues_report' %}">
                                        <i class="fas fa-chart-line me-2 text-success"></i>
                                        إيرادات
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:monthly_revenues_report' %}">
                                        <i class="fas fa-calendar-check me-2 text-success"></i>
                                        إيرادات شهرية
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:treasury_account_statement' %}">
                                        <i class="fas fa-file-alt me-2 text-info"></i>
                                        كشف حساب الخزينة
                                    </a>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- تقارير البنوك -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-university me-2 text-primary"></i>
                                        البنوك
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:bank_account_statement' %}">
                                        <i class="fas fa-file-alt me-2 text-primary"></i>
                                        كشف حساب البنك
                                    </a>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- تقارير المبيعات -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-shopping-cart me-2 text-success"></i>
                                        المبيعات
                                    </h6>
                                </li>

                                <!-- تقارير المبيعات الأساسية -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-chart-bar me-2 text-success"></i>
                                        تقارير المبيعات الأساسية
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:sales_detailed_report' %}">
                                                <i class="fas fa-list-alt me-2"></i>
                                                تقرير تفصيلي
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:sales_summary_report' %}">
                                                <i class="fas fa-chart-pie me-2"></i>
                                                تقرير إجمالي
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:sales_monthly_report' %}">
                                                <i class="fas fa-calendar me-2"></i>
                                                مبيعات شهرية
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:sales_profit_report' %}">
                                                <i class="fas fa-chart-line me-2"></i>
                                                تحليل الأرباح
                                            </a>
                                        </li>
                                    </ul>
                                </li>

                                <!-- الخصومات والعمولات -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-percentage me-2 text-warning"></i>
                                        الخصومات والعمولات
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:sales_discounts_report' %}">
                                                <i class="fas fa-tags me-2"></i>
                                                خصومات المبيعات
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:representative_commission_report' %}">
                                                <i class="fas fa-user-tie me-2"></i>
                                                عمولة المندوبين
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:employee_commission_report' %}">
                                                <i class="fas fa-user me-2"></i>
                                                عمولة الموظفين
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-calculator me-2"></i>
                                                حاسبة العمولات
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-tags me-2 text-warning"></i>
                                        عروض الأسعار
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="{% url 'reports:quotations_detailed_report' %}">تفصيلية</a></li>
                                        <li><a class="dropdown-item" href="{% url 'reports:quotations_summary_report' %}">إجمالية</a></li>
                                    </ul>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- تقارير المشتريات -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-truck me-2 text-info"></i>
                                        المشتريات
                                    </h6>
                                </li>

                                <!-- تقارير المشتريات الأساسية -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-chart-bar me-2 text-info"></i>
                                        تقارير المشتريات الأساسية
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:purchases_detailed_report' %}">
                                                <i class="fas fa-list-alt me-2"></i>
                                                تقرير تفصيلي
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:purchases_summary_report' %}">
                                                <i class="fas fa-chart-pie me-2"></i>
                                                تقرير إجمالي
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:purchases_monthly_report' %}">
                                                <i class="fas fa-calendar me-2"></i>
                                                مشتريات شهرية
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:purchases_discounts_report' %}">
                                                <i class="fas fa-percentage me-2"></i>
                                                خصومات المشتريات
                                            </a>
                                        </li>
                                    </ul>
                                </li>

                                <!-- أوامر التوريد -->
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-clipboard-list me-2 text-secondary"></i>
                                        أوامر التوريد
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" href="{% url 'reports:supply_orders_report' %}">
                                                <i class="fas fa-list me-2"></i>
                                                قائمة الأوامر
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-clock me-2"></i>
                                                الأوامر المعلقة
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-check me-2"></i>
                                                الأوامر المنفذة
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="fas fa-chart-line me-2"></i>
                                                تحليل الأداء
                                            </a>
                                        </li>
                                    </ul>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- يوميات إجمالية -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-book me-2 text-primary"></i>
                                        يوميات إجمالية
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:general_journals_report' %}">
                                        <i class="fas fa-book-open me-2 text-primary"></i>
                                        يوميات إجمالية
                                    </a>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- تقارير المخازن -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-warehouse me-2 text-warning"></i>
                                        المخازن
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:stock_increases_report' %}">
                                        <i class="fas fa-plus-circle me-2 text-success"></i>
                                        أذون إضافة الزيادات
                                    </a>
                                </li>
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-minus-circle me-2 text-danger"></i>
                                        أذون صرف النواقص
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="{% url 'reports:stock_decreases_detailed_report' %}">تفصيلية</a></li>
                                        <li><a class="dropdown-item" href="{% url 'reports:stock_decreases_monthly_report' %}">أذون صرف شهرية</a></li>
                                        <li><a class="dropdown-item" href="{% url 'reports:stock_decreases_renewal_report' %}">تاريخ التجديد</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown-submenu">
                                    <a class="dropdown-item dropdown-toggle" href="#">
                                        <i class="fas fa-exchange-alt me-2 text-info"></i>
                                        التحويلات بين المخازن
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="{% url 'reports:warehouse_transfers_detailed_report' %}">تفصيلية</a></li>
                                        <li><a class="dropdown-item" href="{% url 'reports:warehouse_transfers_summary_report' %}">إجمالية</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:production_report' %}">
                                        <i class="fas fa-cogs me-2 text-primary"></i>
                                        إنتاج تام أو تحت التشغيل
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:items_prices_report' %}">
                                        <i class="fas fa-tags me-2 text-success"></i>
                                        الأصناف وأسعارها
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:item_movement_report' %}">
                                        <i class="fas fa-chart-line me-2 text-info"></i>
                                        حركة صنف
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:inventory_report' %}">
                                        <i class="fas fa-clipboard-check me-2 text-warning"></i>
                                        جرد بضاعة
                                    </a>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- تقارير الأصول الثابتة -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-building me-2 text-secondary"></i>
                                        الأصول الثابتة
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:current_year_depreciation_report' %}">
                                        <i class="fas fa-chart-bar me-2 text-warning"></i>
                                        إهلاك السنة الحالية
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:assets_detailed_report' %}">
                                        <i class="fas fa-list-alt me-2 text-info"></i>
                                        أصول تفصيلية
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:assets_summary_report' %}">
                                        <i class="fas fa-chart-pie me-2 text-primary"></i>
                                        أصول إجمالية
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:assets_sale_profits_report' %}">
                                        <i class="fas fa-hand-holding-usd me-2 text-success"></i>
                                        أرباح بيع أصول
                                    </a>
                                </li>

                                <li><hr class="dropdown-divider"></li>

                                <!-- الوصول السريع -->
                                <li>
                                    <h6 class="dropdown-header">
                                        <i class="fas fa-bolt me-2 text-warning"></i>
                                        الوصول السريع
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:persons_balances' %}">
                                        <i class="fas fa-balance-scale me-2 text-success"></i>
                                        أرصدة الأشخاص
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:sales_monthly_report' %}">
                                        <i class="fas fa-chart-line me-2 text-primary"></i>
                                        المبيعات الشهرية
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:inventory_report' %}">
                                        <i class="fas fa-clipboard-check me-2 text-warning"></i>
                                        جرد البضاعة
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'reports:general_journals_report' %}">
                                        <i class="fas fa-book-open me-2 text-info"></i>
                                        اليوميات الإجمالية
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>

    <!-- Main Content -->
    <main class="main-content">
                <div class="content-wrapper">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}

                    {% block content %}{% endblock %}
                </div>
            </main>

    <!-- Quick Access Button -->
    <button class="quick-access-btn" onclick="toggleQuickAccess()" title="الوصول السريع للفروع">
        <i class="fas fa-sitemap"></i>
    </button>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'Africa/Cairo'
            };
            
            const dateTimeString = now.toLocaleDateString('ar-EG', options);
            const element = document.getElementById('current-datetime');
            if (element) {
                element.textContent = dateTimeString;
            }
        }
        
        // Update every second
        setInterval(updateDateTime, 1000);
        updateDateTime(); // Initial call
        
        // Mobile sidebar toggle
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.querySelector('[data-bs-target="#sidebar"]');
            const sidebar = document.getElementById('sidebar');

            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                });
            }

            // Handle Easy Dropdown
            const easyDropdowns = document.querySelectorAll('.easy-dropdown');

            easyDropdowns.forEach(function(dropdown) {
                const toggle = dropdown.querySelector('.dropdown-toggle');
                const menu = dropdown.querySelector('.dropdown-menu');

                if (toggle && menu) {
                    let hoverTimeout;
                    let isOpen = false;

                    // Show dropdown on hover (desktop)
                    dropdown.addEventListener('mouseenter', function() {
                        if (window.innerWidth > 768) {
                            clearTimeout(hoverTimeout);
                            showDropdown();
                        }
                    });

                    // Hide dropdown when leaving (desktop)
                    dropdown.addEventListener('mouseleave', function(e) {
                        if (window.innerWidth > 768 && !dropdown.contains(e.relatedTarget)) {
                            hoverTimeout = setTimeout(() => {
                                hideDropdown();
                            }, 200);
                        }
                    });

                    // Handle click for mobile and desktop
                    toggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();

                        if (isOpen) {
                            hideDropdown();
                        } else {
                            showDropdown();
                        }
                    });

                    function showDropdown() {
                        if (!isOpen) {
                            menu.style.display = 'block';
                            menu.style.opacity = '0';
                            menu.style.transform = 'translateY(-15px) scale(0.95)';

                            setTimeout(() => {
                                menu.style.transition = 'all 0.3s ease';
                                menu.style.opacity = '1';
                                menu.style.transform = 'translateY(0) scale(1)';
                            }, 10);

                            isOpen = true;
                            toggle.setAttribute('aria-expanded', 'true');
                        }
                    }

                    function hideDropdown() {
                        if (isOpen) {
                            menu.style.transition = 'all 0.2s ease';
                            menu.style.opacity = '0';
                            menu.style.transform = 'translateY(-15px) scale(0.95)';

                            setTimeout(() => {
                                menu.style.display = 'none';
                            }, 200);

                            isOpen = false;
                            toggle.setAttribute('aria-expanded', 'false');
                        }
                    }
                }
            });

            // Handle easy dropdown items hover effects
            const easyDropdownItems = document.querySelectorAll('.easy-dropdown-item');
            easyDropdownItems.forEach(function(item) {
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(-3px)';
                });

                item.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0)';
                });

                // Add click effect
                item.addEventListener('click', function() {
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = 'translateX(-3px)';
                    }, 100);
                });
            });

            // Close all easy dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                easyDropdowns.forEach(function(dropdown) {
                    const menu = dropdown.querySelector('.dropdown-menu');
                    const toggle = dropdown.querySelector('.dropdown-toggle');

                    if (!dropdown.contains(e.target) && menu.style.display === 'block') {
                        menu.style.transition = 'all 0.2s ease';
                        menu.style.opacity = '0';
                        menu.style.transform = 'translateY(-15px) scale(0.95)';

                        setTimeout(() => {
                            menu.style.display = 'none';
                        }, 200);

                        toggle.setAttribute('aria-expanded', 'false');
                    }
                });
            });

            // Handle touch devices for easy dropdowns
            if ('ontouchstart' in window) {
                easyDropdowns.forEach(function(dropdown) {
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    const menu = dropdown.querySelector('.dropdown-menu');

                    if (toggle && menu) {
                        // Add touch feedback
                        toggle.addEventListener('touchstart', function(e) {
                            toggle.style.transform = 'scale(0.98)';
                            setTimeout(() => {
                                toggle.style.transform = 'scale(1)';
                            }, 100);
                        });

                        // Prevent hover effects on touch devices
                        dropdown.style.pointerEvents = 'auto';
                    }
                });

                // Enhanced touch feedback for dropdown items
                easyDropdownItems.forEach(function(item) {
                    item.addEventListener('touchstart', function(e) {
                        this.style.transform = 'scale(0.98)';
                        setTimeout(() => {
                            this.style.transform = 'translateX(-3px)';
                        }, 100);
                    });
                });
            }

            // Add keyboard navigation support for easy dropdowns
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // Close all easy dropdowns on Escape
                    easyDropdowns.forEach(function(dropdown) {
                        const menu = dropdown.querySelector('.dropdown-menu');
                        const toggle = dropdown.querySelector('.dropdown-toggle');

                        if (menu.style.display === 'block') {
                            menu.style.transition = 'all 0.2s ease';
                            menu.style.opacity = '0';
                            menu.style.transform = 'translateY(-15px) scale(0.95)';

                            setTimeout(() => {
                                menu.style.display = 'none';
                            }, 200);

                            toggle.setAttribute('aria-expanded', 'false');
                            toggle.focus(); // Return focus to toggle
                        }
                    });
                }
            });

            // Add loading animation when needed
            function showDropdownLoading(dropdown) {
                const menu = dropdown.querySelector('.dropdown-menu');
                menu.innerHTML = '<div class="dropdown-loading"><div class="dropdown-spinner"></div></div>';
            }

            // Add success feedback for actions
            function showActionFeedback(item, message) {
                const originalText = item.querySelector('.item-text').textContent;
                const textElement = item.querySelector('.item-text');

                textElement.textContent = message || 'تم بنجاح!';
                item.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';

                setTimeout(() => {
                    textElement.textContent = originalText;
                    item.style.background = '';
                }, 2000);
            }

            // Quick access button functionality
            window.toggleQuickAccess = function() {
                const branchesDropdown = document.getElementById('branchesDropdown');
                const quickBtn = document.querySelector('.quick-access-btn');

                if (branchesDropdown && quickBtn) {
                    // Add visual feedback
                    quickBtn.style.transform = 'scale(0.9)';
                    quickBtn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';

                    setTimeout(() => {
                        quickBtn.style.transform = 'scale(1.1)';

                        // Find the dropdown menu and show it
                        const dropdownMenu = branchesDropdown.nextElementSibling;
                        if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                            // Show dropdown with animation
                            dropdownMenu.style.display = 'block';
                            dropdownMenu.style.opacity = '0';
                            dropdownMenu.style.transform = 'translateY(-15px) scale(0.95)';

                            setTimeout(() => {
                                dropdownMenu.style.transition = 'all 0.3s ease';
                                dropdownMenu.style.opacity = '1';
                                dropdownMenu.style.transform = 'translateY(0) scale(1)';
                            }, 10);

                            branchesDropdown.setAttribute('aria-expanded', 'true');

                            // Auto-hide after 5 seconds
                            setTimeout(() => {
                                if (dropdownMenu.style.display === 'block') {
                                    dropdownMenu.style.transition = 'all 0.2s ease';
                                    dropdownMenu.style.opacity = '0';
                                    dropdownMenu.style.transform = 'translateY(-15px) scale(0.95)';

                                    setTimeout(() => {
                                        dropdownMenu.style.display = 'none';
                                        branchesDropdown.setAttribute('aria-expanded', 'false');
                                    }, 200);
                                }
                            }, 5000);
                        }

                        setTimeout(() => {
                            quickBtn.style.transform = 'scale(1)';
                            quickBtn.style.background = '';
                        }, 100);
                    }, 100);
                } else {
                    // Fallback: show notification if branches dropdown not found
                    if (quickBtn) {
                        quickBtn.style.transform = 'scale(0.9)';
                        quickBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';

                        setTimeout(() => {
                            quickBtn.style.transform = 'scale(1)';
                            quickBtn.style.background = '';
                        }, 200);

                        // Show notification
                        if (typeof showNotification === 'function') {
                            showNotification('قائمة الفروع غير متاحة حالياً', 'warning');
                        } else {
                            alert('قائمة الفروع غير متاحة حالياً');
                        }
                    }
                }
            }

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const branchesDropdown = document.getElementById('branchesDropdown');
                const quickBtn = document.querySelector('.quick-access-btn');

                if (branchesDropdown && quickBtn) {
                    const dropdownMenu = branchesDropdown.nextElementSibling;

                    if (dropdownMenu &&
                        !branchesDropdown.contains(event.target) &&
                        !dropdownMenu.contains(event.target) &&
                        !quickBtn.contains(event.target)) {

                        if (dropdownMenu.style.display === 'block') {
                            dropdownMenu.style.transition = 'all 0.2s ease';
                            dropdownMenu.style.opacity = '0';
                            dropdownMenu.style.transform = 'translateY(-15px) scale(0.95)';

                            setTimeout(() => {
                                dropdownMenu.style.display = 'none';
                                branchesDropdown.setAttribute('aria-expanded', 'false');
                            }, 200);
                        }
                    }
                }
            });

            // Global notification function
            window.showNotification = function(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
                notification.style.cssText = 'top: 80px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px;';
                notification.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-${type === 'info' ? 'info-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'times-circle'} me-2"></i>
                        <span>${message}</span>
                        <button type="button" class="btn-close ms-auto" onclick="this.closest('.alert').remove()"></button>
                    </div>
                `;

                document.body.appendChild(notification);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.transition = 'all 0.3s ease';
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => {
                            notification.remove();
                        }, 300);
                    }
                }, 5000);
            };

            // تمرير القائمة الجانبية بعجلة الماوس - حل مباشر
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                console.log('تم العثور على القائمة الجانبية');

                // إزالة أي معالجات سابقة
                sidebar.onwheel = null;
                sidebar.onmousewheel = null;

                // معالج مباشر وبسيط لعجلة الماوس
                sidebar.addEventListener('wheel', function(event) {
                    console.log('تم اكتشاف حركة عجلة الماوس');

                    // منع التمرير الافتراضي للصفحة
                    event.preventDefault();
                    event.stopPropagation();

                    // حساب اتجاه ومقدار التمرير
                    const delta = event.deltaY;
                    const scrollSpeed = 60; // سرعة التمرير

                    // تطبيق التمرير مباشرة
                    if (delta > 0) {
                        // تمرير لأسفل
                        sidebar.scrollTop += scrollSpeed;
                        console.log('تمرير لأسفل');
                    } else {
                        // تمرير لأعلى
                        sidebar.scrollTop -= scrollSpeed;
                        console.log('تمرير لأعلى');
                    }

                    return false;
                }, { passive: false });

                // معالج إضافي للمتصفحات القديمة
                sidebar.addEventListener('mousewheel', function(event) {
                    event.preventDefault();
                    const delta = -event.wheelDelta / 120;
                    sidebar.scrollTop += delta * 60;
                    return false;
                }, { passive: false });

                // معالج Firefox القديم
                sidebar.addEventListener('DOMMouseScroll', function(event) {
                    event.preventDefault();
                    sidebar.scrollTop += event.detail * 60;
                    return false;
                }, { passive: false });

                // معالج عام على مستوى document كحل احتياطي
                let mouseOverSidebar = false;

                sidebar.addEventListener('mouseenter', function() {
                    mouseOverSidebar = true;
                    console.log('الماوس دخل القائمة الجانبية');
                });

                sidebar.addEventListener('mouseleave', function() {
                    mouseOverSidebar = false;
                    console.log('الماوس خرج من القائمة الجانبية');
                });

                // معالج document للتأكد من عمل التمرير
                document.addEventListener('wheel', function(event) {
                    if (mouseOverSidebar) {
                        console.log('تمرير على مستوى document');
                        event.preventDefault();
                        event.stopPropagation();

                        const delta = event.deltaY;
                        const scrollSpeed = 60;

                        if (delta > 0) {
                            sidebar.scrollTop += scrollSpeed;
                        } else {
                            sidebar.scrollTop -= scrollSpeed;
                        }

                        return false;
                    }
                }, { passive: false });

                // اختبار بسيط للتأكد من أن القائمة قابلة للتمرير
                console.log('ارتفاع القائمة:', sidebar.scrollHeight);
                console.log('ارتفاع المنطقة المرئية:', sidebar.clientHeight);
                console.log('هل القائمة قابلة للتمرير؟', sidebar.scrollHeight > sidebar.clientHeight);

                // إضافة محتوى وهمي للاختبار إذا لم تكن القائمة قابلة للتمرير
                if (sidebar.scrollHeight <= sidebar.clientHeight) {
                    console.log('إضافة محتوى للاختبار...');
                    const testDiv = document.createElement('div');
                    testDiv.style.height = '200px';
                    testDiv.style.background = 'rgba(255,255,255,0.1)';
                    testDiv.style.margin = '10px';
                    testDiv.style.borderRadius = '5px';
                    testDiv.innerHTML = '<p style="padding: 20px; color: white;">محتوى اختبار للتمرير</p>';
                    sidebar.appendChild(testDiv);
                }

                // إضافة مؤشر بصري للتمرير (اختياري)
                let scrollTimeout;
                sidebar.addEventListener('scroll', function() {
                    // إضافة كلاس للإشارة إلى التمرير النشط
                    sidebar.classList.add('scrolling');

                    // إزالة الكلاس بعد توقف التمرير
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        sidebar.classList.remove('scrolling');
                    }, 150);
                });

                // تحسين التمرير للأجهزة اللوحية
                let isScrolling = false;
                sidebar.addEventListener('touchstart', function() {
                    isScrolling = true;
                });

                sidebar.addEventListener('touchend', function() {
                    setTimeout(() => {
                        isScrolling = false;
                    }, 100);
                });

                // إضافة مؤشرات التمرير
                const addScrollIndicators = () => {
                    // إزالة المؤشرات الموجودة
                    const existingIndicators = sidebar.querySelectorAll('.scroll-indicator');
                    existingIndicators.forEach(indicator => indicator.remove());

                    // التحقق من إمكانية التمرير
                    if (sidebar.scrollHeight > sidebar.clientHeight) {
                        // مؤشر التمرير للأعلى
                        const topIndicator = document.createElement('div');
                        topIndicator.className = 'scroll-indicator scroll-top';
                        topIndicator.innerHTML = '<i class="fas fa-chevron-up"></i>';
                        topIndicator.style.cssText = `
                            position: absolute;
                            top: 10px;
                            left: 50%;
                            transform: translateX(-50%);
                            background: rgba(255,255,255,0.2);
                            color: white;
                            padding: 5px 10px;
                            border-radius: 15px;
                            font-size: 12px;
                            opacity: 0;
                            transition: opacity 0.3s ease;
                            pointer-events: none;
                            z-index: 10;
                        `;

                        // مؤشر التمرير للأسفل
                        const bottomIndicator = document.createElement('div');
                        bottomIndicator.className = 'scroll-indicator scroll-bottom';
                        bottomIndicator.innerHTML = '<i class="fas fa-chevron-down"></i>';
                        bottomIndicator.style.cssText = `
                            position: absolute;
                            bottom: 10px;
                            left: 50%;
                            transform: translateX(-50%);
                            background: rgba(255,255,255,0.2);
                            color: white;
                            padding: 5px 10px;
                            border-radius: 15px;
                            font-size: 12px;
                            opacity: 0;
                            transition: opacity 0.3s ease;
                            pointer-events: none;
                            z-index: 10;
                        `;

                        sidebar.appendChild(topIndicator);
                        sidebar.appendChild(bottomIndicator);

                        // إظهار/إخفاء المؤشرات حسب موضع التمرير
                        const updateIndicators = () => {
                            const scrollTop = sidebar.scrollTop;
                            const scrollHeight = sidebar.scrollHeight;
                            const clientHeight = sidebar.clientHeight;

                            // مؤشر الأعلى
                            if (scrollTop > 50) {
                                topIndicator.style.opacity = '1';
                            } else {
                                topIndicator.style.opacity = '0';
                            }

                            // مؤشر الأسفل
                            if (scrollTop < scrollHeight - clientHeight - 50) {
                                bottomIndicator.style.opacity = '1';
                            } else {
                                bottomIndicator.style.opacity = '0';
                            }
                        };

                        sidebar.addEventListener('scroll', updateIndicators);
                        updateIndicators(); // تحديث أولي
                    }
                };

                // إضافة المؤشرات عند تحميل الصفحة
                setTimeout(addScrollIndicators, 500);

                // إعادة إضافة المؤشرات عند تغيير حجم النافذة
                window.addEventListener('resize', addScrollIndicators);

                // تحسين التمرير بلوحة المفاتيح
                sidebar.addEventListener('keydown', function(e) {
                    const scrollAmount = 50;

                    switch(e.key) {
                        case 'ArrowUp':
                            e.preventDefault();
                            sidebar.scrollTop -= scrollAmount;
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            sidebar.scrollTop += scrollAmount;
                            break;
                        case 'PageUp':
                            e.preventDefault();
                            sidebar.scrollTop -= sidebar.clientHeight * 0.8;
                            break;
                        case 'PageDown':
                            e.preventDefault();
                            sidebar.scrollTop += sidebar.clientHeight * 0.8;
                            break;
                        case 'Home':
                            e.preventDefault();
                            sidebar.scrollTop = 0;
                            break;
                        case 'End':
                            e.preventDefault();
                            sidebar.scrollTop = sidebar.scrollHeight;
                            break;
                    }
                });

                // جعل القائمة الجانبية قابلة للتركيز
                sidebar.setAttribute('tabindex', '0');

                // ضمان أن القائمة تستقبل أحداث الماوس
                sidebar.style.pointerEvents = 'auto';
                sidebar.style.userSelect = 'none';

                // إضافة مؤشر للتأكد من أن التمرير يعمل
                let scrollIndicator = null;

                const showScrollIndicator = (direction) => {
                    // إزالة المؤشر السابق
                    if (scrollIndicator) {
                        scrollIndicator.remove();
                    }

                    // إنشاء مؤشر جديد
                    scrollIndicator = document.createElement('div');
                    scrollIndicator.style.cssText = `
                        position: fixed;
                        top: 50%;
                        right: 300px;
                        background: rgba(0,0,0,0.8);
                        color: white;
                        padding: 10px 15px;
                        border-radius: 20px;
                        font-size: 14px;
                        z-index: 9999;
                        transform: translateY(-50%);
                        transition: opacity 0.3s ease;
                    `;
                    scrollIndicator.innerHTML = `<i class="fas fa-mouse"></i> ${direction === 'up' ? 'تمرير لأعلى' : 'تمرير لأسفل'}`;

                    document.body.appendChild(scrollIndicator);

                    // إخفاء المؤشر بعد ثانية واحدة
                    setTimeout(() => {
                        if (scrollIndicator) {
                            scrollIndicator.style.opacity = '0';
                            setTimeout(() => {
                                if (scrollIndicator) {
                                    scrollIndicator.remove();
                                    scrollIndicator = null;
                                }
                            }, 300);
                        }
                    }, 1000);
                };

                // إضافة مؤشر التمرير للاختبار (يمكن إزالته لاحقاً)
                let lastScrollTime = 0;
                sidebar.addEventListener('scroll', function() {
                    const now = Date.now();
                    if (now - lastScrollTime > 100) { // تجنب الإفراط في الإشعارات
                        lastScrollTime = now;
                        // يمكن إضافة مؤشر هنا للتأكد من أن التمرير يعمل
                    }
                });
            }

            // Auto-hide quick access button when dropdown is open
            easyDropdowns.forEach(function(dropdown) {
                const toggle = dropdown.querySelector('.dropdown-toggle');
                const quickBtn = document.querySelector('.quick-access-btn');

                if (toggle && quickBtn) {
                    toggle.addEventListener('click', function() {
                        setTimeout(() => {
                            const menu = dropdown.querySelector('.dropdown-menu');
                            if (menu.style.display === 'block') {
                                quickBtn.style.opacity = '0.3';
                                quickBtn.style.pointerEvents = 'none';
                            } else {
                                quickBtn.style.opacity = '1';
                                quickBtn.style.pointerEvents = 'auto';
                            }
                        }, 100);
                    });
                }
            });
        });
    </script>

    <script>
        // Apply taskbar settings
        document.addEventListener('DOMContentLoaded', function() {
            {% if user_taskbar_settings %}
            const navbar = document.querySelector('.top-navbar');
            const mainContent = document.querySelector('.main-content');

            // Apply show/hide settings
            {% if not user_taskbar_settings.show_icons %}
            navbar.classList.add('taskbar-hide-icons');
            {% endif %}

            {% if not user_taskbar_settings.show_text %}
            navbar.classList.add('taskbar-hide-text');
            {% endif %}

            // Apply menu order if available
            {% if user_taskbar_settings.menu_order %}
            const menuOrder = {{ user_taskbar_settings.menu_order|safe }};
            const navbarNav = navbar.querySelector('.navbar-nav');

            if (menuOrder && menuOrder.length > 0 && navbarNav) {
                const menuItems = {};

                // Collect all menu items
                navbarNav.querySelectorAll('.nav-item').forEach(item => {
                    const menuId = item.getAttribute('data-menu-id');
                    if (menuId) {
                        menuItems[menuId] = item;
                    }
                });

                // Reorder based on saved order
                menuOrder.forEach(menuId => {
                    if (menuItems[menuId]) {
                        navbarNav.appendChild(menuItems[menuId]);
                    }
                });
            }
            {% endif %}

            // Adjust main content for vertical taskbar
            {% if user_taskbar_settings.position == 'VERTICAL' %}
            if (mainContent) {
                mainContent.style.marginLeft = '80px';
            }
            {% endif %}
            {% endif %}
        });

        // UI Settings JavaScript
        {% if ui_settings.ui_show_tooltips %}
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        {% endif %}

        // Apply animation classes if enabled
        {% if ui_settings.ui_enable_animations %}
        const animatedElements = document.querySelectorAll('.card, .modal, .alert');
        animatedElements.forEach(function(element) {
            element.classList.add('fade-in');
        });
        {% endif %}

        // Apply compact mode classes
        {% if ui_settings.ui_compact_mode %}
        document.body.classList.add('compact-mode');
        {% endif %}

        // Apply dark mode classes
        {% if ui_settings.ui_enable_dark_mode %}
        document.body.classList.add('dark-mode');
        {% endif %}

        // Apply table settings
        const tables = document.querySelectorAll('.table');
        tables.forEach(function(table) {
            {% if ui_settings.ui_table_striped %}
            table.classList.add('table-striped');
            {% endif %}

            {% if ui_settings.ui_table_hover %}
            table.classList.add('table-hover');
            {% endif %}

            // Apply pagination settings
            const pagination = table.closest('.table-responsive')?.nextElementSibling?.querySelector('.pagination');
            if (pagination) {
                const pageSize = {{ ui_settings.ui_records_per_page|default:25 }};
                // Apply page size if pagination exists
                pagination.setAttribute('data-page-size', pageSize);
            }
        });

        // Breadcrumbs visibility
        {% if not ui_settings.ui_enable_breadcrumbs %}
        const breadcrumbs = document.querySelectorAll('.breadcrumb, nav[aria-label="breadcrumb"]');
        breadcrumbs.forEach(function(breadcrumb) {
            breadcrumb.style.display = 'none';
        });
        {% endif %}

        // Notifications settings
        {% if not ui_settings.ui_enable_notifications %}
        // Disable notifications
        if (typeof showNotification === 'function') {
            window.showNotification = function() {
                // Do nothing
            };
        }
        {% endif %}

        // Apply RTL if enabled
        {% if ui_settings.ui_enable_rtl %}
        document.documentElement.setAttribute('dir', 'rtl');
        document.body.classList.add('rtl-mode');
        {% endif %}

        // Apply sidebar settings
        {% if ui_settings.ui_sidebar_collapsed %}
        const sidebar = document.getElementById('sidebar');
        if (sidebar) {
            sidebar.classList.add('collapsed');
        }
        {% endif %}

        // Apply tooltips if enabled
        {% if ui_settings.ui_show_tooltips %}
        // Initialize Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        {% endif %}

        // Apply company branding
        {% if system_settings.company_name %}
        document.title = document.title.replace('أوساريك', '{{ system_settings.company_name }}');
        {% endif %}

        // Apply currency formatting globally
        window.formatCurrency = function(amount) {
            const symbol = '{{ system_settings.currency_symbol|default:"ر.س" }}';
            const decimals = {{ system_settings.decimal_places|default:2 }};
            return parseFloat(amount).toFixed(decimals) + ' ' + symbol;
        };

        // Apply tax calculation globally
        window.calculateTax = function(amount) {
            const taxRate = {{ system_settings.tax_rate|default:15.0 }};
            return parseFloat(amount) * (taxRate / 100);
        };

        // Apply pagination settings
        const paginationElements = document.querySelectorAll('.pagination');
        paginationElements.forEach(function(pagination) {
            const pageSize = {{ ui_settings.ui_records_per_page|default:25 }};
            pagination.setAttribute('data-page-size', pageSize);
        });

        // Apply print settings
        {% if system_settings.print_logo %}
        const printStyles = document.createElement('style');
        printStyles.textContent = `
            @media print {
                .company-logo { display: block !important; }
            }
        `;
        document.head.appendChild(printStyles);
        {% endif %}

        // Apply barcode settings
        window.barcodeSettings = {
            type: '{{ system_settings.barcode_type|default:"CODE128" }}',
            width: {{ system_settings.barcode_width|default:2 }},
            height: {{ system_settings.barcode_height|default:50 }},
            showText: {% if system_settings.barcode_show_text == 'true' %}true{% else %}false{% endif %}
        };

        // Global Search Functionality
        const globalSearchInput = document.getElementById('globalSearchInput');
        const globalSearchBtn = document.getElementById('globalSearchBtn');
        const globalSearchResults = document.getElementById('globalSearchResults');

        // Mobile Search Elements
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const mobileSearchBtn = document.getElementById('mobileSearchBtn');
        const mobileSearchResults = document.getElementById('mobileSearchResults');

        let searchLoading, searchContent, searchNoResults;

        let searchTimeout;
        let currentSearchQuery = '';

        // Initialize search elements based on screen size
        function initializeSearchElements() {
            if (window.innerWidth <= 768) {
                // Mobile
                if (mobileSearchResults) {
                    searchLoading = mobileSearchResults.querySelector('.search-loading');
                    searchContent = mobileSearchResults.querySelector('.search-content');
                    searchNoResults = mobileSearchResults.querySelector('.search-no-results');
                }
            } else {
                // Desktop
                if (globalSearchResults) {
                    searchLoading = globalSearchResults.querySelector('.search-loading');
                    searchContent = globalSearchResults.querySelector('.search-content');
                    searchNoResults = globalSearchResults.querySelector('.search-no-results');
                }
            }
        }

        // Initialize on load
        initializeSearchElements();

        // Re-initialize on resize
        window.addEventListener('resize', initializeSearchElements);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+K or Cmd+K to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = window.innerWidth <= 768 ? mobileSearchInput : globalSearchInput;
                if (searchInput) {
                    searchInput.focus();
                    searchInput.select();
                }
            }

            // Escape to clear and blur search
            if (e.key === 'Escape') {
                if (globalSearchInput && document.activeElement === globalSearchInput) {
                    globalSearchInput.value = '';
                    globalSearchInput.blur();
                    hideSearchResults(false);
                }
                if (mobileSearchInput && document.activeElement === mobileSearchInput) {
                    mobileSearchInput.value = '';
                    mobileSearchInput.blur();
                    hideSearchResults(true);
                }
            }
        });

        // Search input event listeners for desktop
        if (globalSearchInput) {
            globalSearchInput.addEventListener('input', function() {
                const query = this.value.trim();

                if (query.length >= 2) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        performSearch(query);
                    }, 300);
                } else {
                    hideSearchResults();
                }
            });

            globalSearchInput.addEventListener('focus', function() {
                if (this.value.trim().length >= 2) {
                    showSearchResults();
                }
            });

            globalSearchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = this.value.trim();
                    if (query.length >= 2) {
                        performSearch(query);
                    }
                } else if (e.key === 'Escape') {
                    hideSearchResults();
                    this.blur();
                }
            });
        }

        // Search button click for desktop
        if (globalSearchBtn) {
            globalSearchBtn.addEventListener('click', function() {
                const query = globalSearchInput.value.trim();
                if (query.length >= 2) {
                    performSearch(query, false);
                }
            });
        }

        // Search input event listeners for mobile
        if (mobileSearchInput) {
            mobileSearchInput.addEventListener('input', function() {
                const query = this.value.trim();

                if (query.length >= 2) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        performSearch(query, true);
                    }, 300);
                } else {
                    hideSearchResults(true);
                }
            });

            mobileSearchInput.addEventListener('focus', function() {
                if (this.value.trim().length >= 2) {
                    showSearchResults(true);
                }
            });

            mobileSearchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = this.value.trim();
                    if (query.length >= 2) {
                        performSearch(query, true);
                    }
                } else if (e.key === 'Escape') {
                    hideSearchResults(true);
                    this.blur();
                }
            });
        }

        // Search button click for mobile
        if (mobileSearchBtn) {
            mobileSearchBtn.addEventListener('click', function() {
                const query = mobileSearchInput.value.trim();
                if (query.length >= 2) {
                    performSearch(query, true);
                }
            });
        }

        // Hide search results when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.global-search-container')) {
                hideSearchResults(false);
            }
            if (!e.target.closest('.mobile-search-container')) {
                hideSearchResults(true);
            }
        });

        function performSearch(query, isMobile = false) {
            if (query === currentSearchQuery) return;

            currentSearchQuery = query;
            showSearchResults(isMobile);
            showLoading(isMobile);

            // Simulate API call - replace with actual search endpoint
            fetch(`/api/global-search/?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    hideLoading(isMobile);
                    displaySearchResults(data, isMobile);
                })
                .catch(error => {
                    console.error('Search error:', error);
                    hideLoading(isMobile);
                    // Fallback to mock data for demonstration
                    displayMockResults(query, isMobile);
                });
        }

        function showSearchResults(isMobile = false) {
            const resultsContainer = isMobile ? mobileSearchResults : globalSearchResults;
            if (resultsContainer) {
                resultsContainer.classList.remove('d-none');
            }
        }

        function hideSearchResults(isMobile = false) {
            const resultsContainer = isMobile ? mobileSearchResults : globalSearchResults;
            if (resultsContainer) {
                resultsContainer.classList.add('d-none');
            }
            currentSearchQuery = '';
        }

        function showLoading(isMobile = false) {
            initializeSearchElements();
            if (searchLoading && searchContent && searchNoResults) {
                searchLoading.classList.remove('d-none');
                searchContent.innerHTML = '';
                searchNoResults.classList.add('d-none');
            }
        }

        function hideLoading(isMobile = false) {
            if (searchLoading) {
                searchLoading.classList.add('d-none');
            }
        }

        function displaySearchResults(data, isMobile = false) {
            initializeSearchElements();
            if (!searchContent || !searchNoResults) return;

            searchContent.innerHTML = '';

            if (!data || !data.results || data.results.length === 0) {
                searchNoResults.classList.remove('d-none');
                return;
            }

            searchNoResults.classList.add('d-none');

            // Group results by type
            const groupedResults = {};
            data.results.forEach(result => {
                if (!groupedResults[result.type]) {
                    groupedResults[result.type] = [];
                }
                groupedResults[result.type].push(result);
            });

            // Display grouped results
            Object.keys(groupedResults).forEach(type => {
                const typeHeader = document.createElement('div');
                typeHeader.className = 'search-section-header';
                typeHeader.innerHTML = getTypeDisplayName(type);
                searchContent.appendChild(typeHeader);

                groupedResults[type].forEach(result => {
                    const resultElement = createSearchResultElement(result);
                    searchContent.appendChild(resultElement);
                });
            });

            // Add quick actions
            addQuickActions(data.query, isMobile);
        }

        function displayMockResults(query, isMobile = false) {
            const mockData = {
                query: query,
                results: [
                    {
                        type: 'section',
                        title: 'المخزون',
                        description: 'إدارة المخزون والحركات',
                        url: '/inventory/',
                        icon: 'fas fa-boxes'
                    },
                    {
                        type: 'section',
                        title: 'المبيعات',
                        description: 'إدارة فواتير وعمليات المبيعات',
                        url: '/sales/',
                        icon: 'fas fa-shopping-cart'
                    },
                    {
                        type: 'item',
                        title: `صنف: ${query}`,
                        description: 'كود الصنف: ITM001 - فئة: مواد خام',
                        url: '/definitions/items/1/',
                        icon: 'fas fa-box'
                    },
                    {
                        type: 'person',
                        title: `عميل: ${query}`,
                        description: 'رقم الهاتف: 01234567890',
                        url: '/definitions/persons/1/',
                        icon: 'fas fa-user'
                    }
                ]
            };
            displaySearchResults(mockData, isMobile);
        }

        function createSearchResultElement(result) {
            const element = document.createElement('a');
            element.className = 'search-result-item';
            element.href = result.url;

            element.innerHTML = `
                <div class="d-flex align-items-start">
                    <div class="search-result-icon">
                        <i class="${result.icon} text-primary"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div class="search-result-title">${result.title}</div>
                        <div class="search-result-description">${result.description}</div>
                        <span class="search-result-type type-${result.type}">${getTypeDisplayName(result.type)}</span>
                    </div>
                </div>
            `;

            element.addEventListener('click', function() {
                hideSearchResults();
            });

            return element;
        }

        function getTypeDisplayName(type) {
            const typeNames = {
                'section': 'أقسام النظام',
                'item': 'الأصناف',
                'person': 'الأشخاص',
                'invoice': 'الفواتير',
                'warehouse': 'المخازن',
                'bank': 'البنوك',
                'treasury': 'الخزائن',
                'asset': 'الأصول الثابتة',
                'order': 'الطلبات',
                'document': 'المستندات',
                'inventory': 'الجرد'
            };
            return typeNames[type] || type;
        }

        function addQuickActions(query, isMobile = false) {
            const quickActionsDiv = document.createElement('div');
            quickActionsDiv.className = 'search-quick-actions';
            quickActionsDiv.innerHTML = `
                <div class="mb-2"><strong>إجراءات سريعة:</strong></div>
                <a href="/inventory/" class="search-quick-action">
                    <i class="fas fa-boxes me-1"></i>المخزون
                </a>
                <a href="/sales/" class="search-quick-action">
                    <i class="fas fa-shopping-cart me-1"></i>المبيعات
                </a>
                <a href="/definitions/items/create/?name=${encodeURIComponent(query)}" class="search-quick-action">
                    <i class="fas fa-plus me-1"></i>إضافة صنف جديد
                </a>
                <a href="/definitions/persons/create/?name=${encodeURIComponent(query)}" class="search-quick-action">
                    <i class="fas fa-user-plus me-1"></i>إضافة عميل جديد
                </a>
                <a href="/reports/" class="search-quick-action">
                    <i class="fas fa-chart-bar me-1"></i>التقارير
                </a>
            `;
            searchContent.appendChild(quickActionsDiv);
        }

        // Mobile optimizations
        function initMobileOptimizations() {
            // Detect if device is mobile
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            if (isMobile) {
                // Add mobile class to body
                document.body.classList.add('mobile-device');

                // Improve touch scrolling
                document.body.style.webkitOverflowScrolling = 'touch';

                // Prevent zoom on input focus (iOS)
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type !== 'file') {
                        input.style.fontSize = '16px';
                    }
                });

                // Add touch-friendly classes
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach(btn => {
                    btn.classList.add('btn-touch');
                });

                // Improve dropdown behavior on mobile
                const dropdowns = document.querySelectorAll('.dropdown-toggle');
                dropdowns.forEach(dropdown => {
                    dropdown.addEventListener('click', function(e) {
                        e.preventDefault();
                        const menu = this.nextElementSibling;
                        if (menu && menu.classList.contains('dropdown-menu')) {
                            menu.classList.toggle('show');
                        }
                    });
                });

                // Close dropdowns when clicking outside
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.dropdown')) {
                        const openDropdowns = document.querySelectorAll('.dropdown-menu.show');
                        openDropdowns.forEach(menu => {
                            menu.classList.remove('show');
                        });
                    }
                });
            }

            // Handle orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    // Recalculate layouts after orientation change
                    window.dispatchEvent(new Event('resize'));
                }, 100);
            });

            // Improve sidebar behavior on mobile
            const sidebarToggle = document.querySelector('[data-bs-toggle="offcanvas"]');
            const sidebar = document.querySelector('.sidebar');

            if (sidebarToggle && sidebar) {
                // Close sidebar when clicking on main content on mobile
                const mainContent = document.querySelector('.main-content');
                if (mainContent && window.innerWidth <= 768) {
                    mainContent.addEventListener('click', function() {
                        const offcanvas = bootstrap.Offcanvas.getInstance(sidebar);
                        if (offcanvas) {
                            offcanvas.hide();
                        }
                    });
                }
            }
        }

        // Initialize mobile optimizations
        initMobileOptimizations();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Company logo interactions
        const companyLogo = document.querySelector('.header-logo, .header-logo-placeholder');
        if (companyLogo) {
            // Add click animation
            companyLogo.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });

            // Add double-click to show company info
            companyLogo.addEventListener('dblclick', function(e) {
                e.preventDefault();
                showCompanyInfo();
            });
        }

        // Show company information modal
        function showCompanyInfo() {
            const companyName = '{{ system_settings.company_name|default:"شركة أوساريك للحسابات" }}';
            const companyAddress = '{{ system_settings.company_address|default:"" }}';
            const companyPhone = '{{ system_settings.company_phone|default:"" }}';
            const companyEmail = '{{ system_settings.company_email|default:"" }}';

            let infoHtml = `
                <div class="company-info-modal">
                    <h5 class="text-primary mb-3">
                        <i class="fas fa-building me-2"></i>
                        معلومات الشركة
                    </h5>
                    <div class="company-details">
                        <p><strong>اسم الشركة:</strong> ${companyName}</p>
            `;

            if (companyAddress) {
                infoHtml += `<p><strong>العنوان:</strong> ${companyAddress}</p>`;
            }
            if (companyPhone) {
                infoHtml += `<p><strong>الهاتف:</strong> ${companyPhone}</p>`;
            }
            if (companyEmail) {
                infoHtml += `<p><strong>البريد الإلكتروني:</strong> ${companyEmail}</p>`;
            }

            infoHtml += `
                    </div>
                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-primary btn-sm" onclick="this.closest('.alert').remove()">
                            <i class="fas fa-times me-1"></i>
                            إغلاق
                        </button>
                    </div>
                </div>
            `;

            // Create and show notification
            const notification = document.createElement('div');
            notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
            notification.style.cssText = 'top: 80px; right: 20px; z-index: 9999; min-width: 350px; max-width: 500px;';
            notification.innerHTML = infoHtml;

            document.body.appendChild(notification);

            // Auto remove after 10 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 10000);
        }

        // تحديث الساعة والتاريخ
        function updateDateTime() {
            const now = new Date();

            // تنسيق الوقت بتنسيق 12 ساعة
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };

            // تنسيق التاريخ
            const dateOptions = {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                weekday: 'long'
            };

            const timeString = now.toLocaleTimeString('en-US', timeOptions);
            const dateString = now.toLocaleDateString('ar-SA', dateOptions);

            // تحديث العناصر
            const datetimeElement = document.getElementById('current-datetime');
            if (datetimeElement) {
                datetimeElement.innerHTML = `
                    <div class="d-flex flex-column align-items-center">
                        <div class="fw-bold text-primary">
                            <i class="fas fa-clock me-1"></i>
                            ${timeString}
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-calendar me-1"></i>
                            ${dateString}
                        </small>
                    </div>
                `;
            }
        }

        // تحديث الساعة كل ثانية
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);

            // Back to Top Button functionality
            const backToTopBtn = document.getElementById('backToTop');

            if (backToTopBtn) {
                // Show/hide button based on scroll position
                window.addEventListener('scroll', function() {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.classList.remove('d-none');
                    } else {
                        backToTopBtn.classList.add('d-none');
                    }
                });

                // Smooth scroll to top when clicked
                backToTopBtn.addEventListener('click', function() {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            }
        });
    </script>

    <!-- Back to Top Button (Mobile) -->
    <button id="backToTop" class="btn btn-primary position-fixed d-none"
            style="bottom: 20px; right: 20px; z-index: 1000; border-radius: 50%; width: 50px; height: 50px;">
        <i class="fas fa-chevron-up"></i>
    </button>

    {% block extra_js %}{% endblock %}
</body>
</html>
